<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T1U3">reflectivity</span>, <span class="var type1" id="S3T1U4">Simulation</span>] = callReflectivity(<span class="var type1" id="S4T2U7">nbairs</span>,<span class="var type1" id="S5T2U8">nbsubs</span>,<span class="var type1" id="S6T3U9">simLimits</span>,<span class="var type1" id="S7T3U10">repeatLayers</span>,<span class="var type1" id="S8T4U11">this_data</span>,<span class="var type1" id="S9T4U12">layers</span>,<span class="var type1" id="S10T2U13">ssubs</span>,<span class="var type1" id="S11T2U14">backgrounds</span>,<span class="var type1" id="S12T2U15">res</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">% nbairs = problem.nbairs;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">% nbsubs = problem.nbsubs;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">% simLimits = problem.simLimits;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line"><span class="comment">% repeatLayers = problem.repeatLayers;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line"><span class="comment">% allData = problem.shifted_data;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line"><span class="comment">% layers = problem.layers;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line"><span class="comment">% ssubs = problem.ssubs;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line"><span class="comment">% numberOfContrasts = problem.numberOfContrasts;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line"><span class="comment">% reflectivity = cell(numberOfContrasts,1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line"><span class="comment">% Simulation = cell(numberOfContrasts,1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line"><span class="comment">% parfor i = 1:numberOfContrasts</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line"><span class="comment">%this_data = allData{i};</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line"><span class="mxinfo " id="T5:U12"><span class="var type1" id="S13T5U18">xdata</span> = <span class="mxinfo " id="T5:U14"><span class="var type1" id="S8T4U20">this_data</span>(<span class="mxinfo " id="T6:U16">:</span>,<span class="mxinfo " id="T7:U17">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line"><span class="mxinfo " id="T4:U18"><span class="var type1" id="S14T4U25">output</span> = <span class="var type1" id="S9T4U26">layers</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T8:U21">isempty(<span class="var type1" id="S14T4U31">output</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line">    <span class="mxinfo " id="T4:U23"><span class="var type1" id="S16T4U34">slds</span> = <span class="mxinfo " id="T9:U25">[<span class="mxinfo " id="T2:U26">0</span> <span class="var type1" id="S4T2U38">nbairs</span> <span class="mxinfo " id="T2:U28">0</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line">    <span class="mxinfo " id="T2:U29"><span class="var type1" id="S17T2U42">lays</span> = <span class="mxinfo " id="T2:U31">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line">    <span class="mxinfo " id="T4:U32"><span class="var type1" id="S16T4U47">slds</span> = <span class="mxinfo " id="T4:U34"><span class="var type1" id="S14T4U49">output</span>(<span class="mxinfo " id="T6:U36">:</span>,<span class="mxinfo " id="T9:U37"><span class="mxinfo " id="T2:U38">1</span>:<span class="mxinfo " id="T2:U39">3</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27">27</a></span><span class="line">    <span class="mxinfo " id="T2:U40"><span class="var type1" id="S17T2U56">lays</span> = <span class="mxinfo " id="T2:U42">size(<span class="var type1" id="S16T4U59">slds</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28">28</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29">29</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30">30</a></span><span class="line"><span class="mxinfo " id="T2:U44"><span class="var type1" id="S19T2U63">simXLo</span> = <span class="mxinfo " id="T2:U46"><span class="var type1" id="S6T3U65">simLimits</span>(<span class="mxinfo " id="T7:U48">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31">31</a></span><span class="line"><span class="mxinfo " id="T2:U49"><span class="var type1" id="S20T2U69">simXHi</span> = <span class="mxinfo " id="T2:U51"><span class="var type1" id="S6T3U71">simLimits</span>(<span class="mxinfo " id="T7:U53">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32">32</a></span><span class="line"><span class="mxinfo " id="T5:U54"><span class="var type1" id="S21T5U75">middleSection</span> = <span class="mxinfo " id="T5:U56"><span class="var type1" id="S8T4U77">this_data</span>(<span class="mxinfo " id="T6:U58">:</span>,<span class="mxinfo " id="T7:U59">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33">33</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34">34</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T8:U60"><span class="var type1" id="S19T2U83">simXLo</span> &lt; <span class="mxinfo " id="T2:U62"><span class="var type1" id="S13T5U85">xdata</span>(<span class="mxinfo " id="T2:U64">1</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35">35</a></span><span class="line">    <span class="mxinfo " id="T2:U65"><span class="var type1" id="S22T2U89">step</span> = (<span class="mxinfo " id="T2:U67"><span class="mxinfo " id="T2:U68"><span class="var type1" id="S13T5U93">xdata</span>(<span class="mxinfo " id="T2:U70">2</span>)</span>-<span class="mxinfo " id="T2:U71"><span class="var type1" id="S13T5U96">xdata</span>(<span class="mxinfo " id="T2:U73">1</span>)</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36">36</a></span><span class="line">    <span class="mxinfo " id="T10:U74"><span class="var type1" id="S23T10U100">firstSection</span> = <span class="mxinfo " id="T10:U76">[<span class="var type1" id="S19T2U105">simXLo</span>:<span class="var type1" id="S22T2U106">step</span>:(<span class="mxinfo " id="T2:U79"><span class="mxinfo " id="T2:U80"><span class="var type1" id="S13T5U110">xdata</span>(<span class="mxinfo " id="T2:U82">1</span>)</span>-<span class="var type1" id="S22T2U112">step</span></span>)]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37">37</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38">38</a></span><span class="line">    <span class="mxinfo " id="T10:U84"><span class="var type1" id="S23T10U116">firstSection</span> = <span class="mxinfo " id="T11:U86">[]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39">39</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40">40</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41">41</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T8:U87"><span class="var type1" id="S20T2U122">simXHi</span> &gt; <span class="mxinfo " id="T2:U89"><span class="var type1" id="S13T5U124">xdata</span>(<span class="mxinfo " id="T2:U91">end</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42">42</a></span><span class="line">    <span class="mxinfo " id="T2:U92"><span class="var type1" id="S22T2U129">step</span> = (<span class="mxinfo " id="T2:U94"><span class="mxinfo " id="T2:U95"><span class="var type1" id="S13T5U133">xdata</span>(<span class="mxinfo " id="T2:U97">end</span>)</span>-<span class="mxinfo " id="T2:U98"><span class="var type1" id="S13T5U137">xdata</span>(<span class="mxinfo " id="T2:U100"><span class="mxinfo " id="T2:U101">end</span>-<span class="mxinfo " id="T2:U102">1</span></span>,<span class="mxinfo " id="T2:U103">1</span>)</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43">43</a></span><span class="line">    <span class="mxinfo " id="T10:U104"><span class="var type1" id="S25T10U145">lastSection</span> = <span class="mxinfo " id="T10:U106">[<span class="mxinfo " id="T2:U107"><span class="mxinfo " id="T2:U108"><span class="var type1" id="S13T5U152">xdata</span>(<span class="mxinfo " id="T2:U110">end</span>,<span class="mxinfo " id="T7:U111">1</span>)</span>+<span class="var type1" id="S22T2U156">step</span></span>:<span class="var type1" id="S22T2U157">step</span>:<span class="var type1" id="S20T2U158">simXHi</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44">44</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45">45</a></span><span class="line">    <span class="mxinfo " id="T10:U115"><span class="var type1" id="S25T10U162">lastSection</span> = <span class="mxinfo " id="T11:U117">[]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46">46</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47">47</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48">48</a></span><span class="line"><span class="mxinfo " id="T12:U118"><span class="var type1" id="S26T12U167">simXdata</span> = <span class="mxinfo " id="T12:U120"><span class="mxinfo " id="T5:U121">[<span class="mxinfo " id="T5:U122"><span class="var type1" id="S23T10U172">firstSection</span>(:)</span> ; <span class="var type1" id="S21T5U175">middleSection</span> ; <span class="mxinfo " id="T5:U125"><span class="var type1" id="S25T10U178">lastSection</span>(:)</span>]</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49">49</a></span><span class="line"><span class="mxinfo " id="T5:U127"><span class="var type1" id="S27T5U182">trueXdata</span> = <span class="mxinfo " id="T5:U129"><span class="var type1" id="S21T5U184">middleSection</span>(:)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50">50</a></span><span class="line"><span class="mxinfo " id="T9:U131"><span class="var type1" id="S28T9U188">splits</span> = <span class="mxinfo " id="T9:U133">[<span class="mxinfo " id="T2:U134">length(<span class="var type1" id="S23T10U193">firstSection</span>)</span> <span class="mxinfo " id="T2:U136">length(<span class="mxinfo " id="T5:U137"><span class="var type1" id="S21T5U197">middleSection</span>(<span class="mxinfo " id="T6:U139">:</span>,<span class="mxinfo " id="T7:U140">1</span>)</span>)</span> <span class="mxinfo " id="T2:U141">length(<span class="var type1" id="S25T10U202">lastSection</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51">51</a></span><span class="line"><span class="mxinfo " id="T2:U143"><span class="var type1" id="S30T2U205">repeats</span> = <span class="mxinfo " id="T2:U145"><span class="var type1" id="S7T3U207">repeatLayers</span>(<span class="mxinfo " id="T7:U147">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52">52</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53">53</a></span><span class="line"><span class="mxinfo " id="T5:U148"><span class="var type1" id="S31T5U211">simRef</span> = <span class="mxinfo " id="T5:U150"><span class="fcn" id="F157N2:B213">abeles</span>(<span class="var type1" id="S26T12U214">simXdata</span>, <span class="var type1" id="S16T4U215">slds</span>, <span class="var type1" id="S4T2U216">nbairs</span>, <span class="var type1" id="S5T2U217">nbsubs</span>, <span class="var type1" id="S30T2U218">repeats</span>, <span class="var type1" id="S10T2U219">ssubs</span>, <span class="var type1" id="S17T2U220">lays</span>, <span class="mxinfo " id="T2:U158">length(<span class="var type1" id="S26T12U223">simXdata</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54">54</a></span><span class="line"><span class="mxinfo " id="T5:U160"><span class="var type1" id="S31T5U226">simRef</span> = <span class="mxinfo " id="T5:U162"><span class="fcn" id="F161N4:B228">resolution_polly</span>(<span class="var type1" id="S26T12U229">simXdata</span>,<span class="var type1" id="S31T5U230">simRef</span>,<span class="var type1" id="S12T2U231">res</span>,<span class="mxinfo " id="T2:U166">length(<span class="var type1" id="S26T12U234">simXdata</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55">55</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56">56</a></span><span class="line"><span class="mxinfo " id="T2:U168"><span class="var type1" id="S23T2U237">firstSection</span> = <span class="mxinfo " id="T2:U170"><span class="var type1" id="S28T9U239">splits</span>(<span class="mxinfo " id="T7:U172">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57">57</a></span><span class="line"><span class="mxinfo " id="T2:U173"><span class="var type1" id="S21T2U243">middleSection</span> = <span class="mxinfo " id="T2:U175"><span class="var type1" id="S28T9U245">splits</span>(<span class="mxinfo " id="T7:U177">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58">58</a></span><span class="line"><span class="mxinfo " id="T5:U178"><span class="var type1" id="S34T5U249">Ref</span> = <span class="var type1" id="S31T5U250">simRef</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59">59</a></span><span class="line"><span class="mxinfo " id="T5:U181"><span class="var type1" id="S34T5U253">Ref</span> = <span class="mxinfo " id="T5:U183"><span class="var type1" id="S34T5U255">Ref</span>(<span class="mxinfo " id="T5:U185">(<span class="mxinfo " id="T2:U186"><span class="var type1" id="S23T2U259">firstSection</span>+1</span>):(<span class="mxinfo " id="T2:U188"><span class="var type1" id="S23T2U263">firstSection</span>+<span class="var type1" id="S21T2U264">middleSection</span></span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60">60</a></span><span class="line"><span class="mxinfo " id="T5:U191"><span class="var type1" id="S34T5U267">Ref</span> = <span class="mxinfo " id="T5:U193"><span class="var type1" id="S34T5U269">Ref</span> + <span class="var type1" id="S11T2U270">backgrounds</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61">61</a></span><span class="line"><span class="mxinfo " id="T1:U196"><span class="var type1" id="S2T1U273">reflectivity</span> = <span class="mxinfo " id="T1:U198">[<span class="mxinfo " id="T5:U199"><span class="var type1" id="S27T5U277">trueXdata</span>(:)</span> <span class="mxinfo " id="T5:U201"><span class="var type1" id="S34T5U280">Ref</span>(:)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62">62</a></span><span class="line"><span class="mxinfo " id="T5:U203"><span class="var type1" id="S31T5U284">simRef</span> = <span class="mxinfo " id="T5:U205"><span class="var type1" id="S31T5U286">simRef</span> + <span class="var type1" id="S11T2U287">backgrounds</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63">63</a></span><span class="line"><span class="mxinfo " id="T1:U208"><span class="var type1" id="S3T1U290">Simulation</span> = <span class="mxinfo " id="T1:U210">[<span class="mxinfo " id="T5:U211"><span class="var type1" id="S26T12U294">simXdata</span>'</span> <span class="var type1" id="S31T5U295">simRef</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64">64</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65">65</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66">66</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67">67</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
