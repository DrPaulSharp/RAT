<pre class="code">
<span class="srcline"><span class="lineno"><a href="103,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T3U3">reflectivity</span>, <span class="var type1" id="S3T3U4">Simulation</span>] = callReflectivity(<span class="var type1" id="S4T11U7">nbairs</span>,<span class="var type1" id="S5T11U8">nbsubs</span>,<span class="var type1" id="S6T17U9">simLimits</span>,<span class="var type1" id="S7T17U10">repeatLayers</span>,<span class="var type1" id="S8T6U11">this_data</span>,<span class="var type1" id="S9T6U12">layers</span>,<span class="var type1" id="S10T11U13">ssubs</span>,<span class="var type1" id="S11T11U14">backgrounds</span>,<span class="var type1" id="S12T11U15">res</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="103,2" id="srcline2"> 2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="103,3" id="srcline3"> 3</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="103,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">% nbairs = problem.nbairs;</span></span></span>
<span class="srcline"><span class="lineno"><a href="103,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">% nbsubs = problem.nbsubs;</span></span></span>
<span class="srcline"><span class="lineno"><a href="103,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">% simLimits = problem.simLimits;</span></span></span>
<span class="srcline"><span class="lineno"><a href="103,7" id="srcline7"> 7</a></span><span class="line"><span class="comment">% repeatLayers = problem.repeatLayers;</span></span></span>
<span class="srcline"><span class="lineno"><a href="103,8" id="srcline8"> 8</a></span><span class="line"><span class="comment">% allData = problem.shifted_data;</span></span></span>
<span class="srcline"><span class="lineno"><a href="103,9" id="srcline9"> 9</a></span><span class="line"><span class="comment">% layers = problem.layers;</span></span></span>
<span class="srcline"><span class="lineno"><a href="103,10" id="srcline10">10</a></span><span class="line"><span class="comment">% ssubs = problem.ssubs;</span></span></span>
<span class="srcline"><span class="lineno"><a href="103,11" id="srcline11">11</a></span><span class="line"><span class="comment">% numberOfContrasts = problem.numberOfContrasts;</span></span></span>
<span class="srcline"><span class="lineno"><a href="103,12" id="srcline12">12</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="103,13" id="srcline13">13</a></span><span class="line"><span class="comment">% reflectivity = cell(numberOfContrasts,1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="103,14" id="srcline14">14</a></span><span class="line"><span class="comment">% Simulation = cell(numberOfContrasts,1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="103,15" id="srcline15">15</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="103,16" id="srcline16">16</a></span><span class="line"><span class="comment">% parfor i = 1:numberOfContrasts</span></span></span>
<span class="srcline"><span class="lineno"><a href="103,17" id="srcline17">17</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="103,18" id="srcline18">18</a></span><span class="line"><span class="comment">%this_data = allData{i};</span></span></span>
<span class="srcline"><span class="lineno"><a href="103,19" id="srcline19">19</a></span><span class="line"><span class="mxinfo " id="T1:U12"><span class="var type1" id="S13T1U18">xdata</span> = <span class="mxinfo " id="T1:U14"><span class="var type1" id="S8T6U20">this_data</span>(<span class="mxinfo " id="T59:U16">:</span>,<span class="mxinfo " id="T28:U17">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="103,20" id="srcline20">20</a></span><span class="line"><span class="mxinfo " id="T6:U18"><span class="var type1" id="S14T6U25">output</span> = <span class="var type1" id="S9T6U26">layers</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="103,21" id="srcline21">21</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="103,22" id="srcline22">22</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T26:U21">isempty(<span class="var type1" id="S14T6U31">output</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="103,23" id="srcline23">23</a></span><span class="line">    <span class="mxinfo " id="T6:U23"><span class="var type1" id="S16T6U34">slds</span> = <span class="mxinfo " id="T60:U25">[<span class="mxinfo " id="T11:U26">0</span> <span class="var type1" id="S4T11U38">nbairs</span> <span class="mxinfo " id="T11:U28">0</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="103,24" id="srcline24">24</a></span><span class="line">    <span class="mxinfo " id="T11:U29"><span class="var type1" id="S17T11U42">lays</span> = <span class="mxinfo " id="T11:U31">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="103,25" id="srcline25">25</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="103,26" id="srcline26">26</a></span><span class="line">    <span class="mxinfo " id="T6:U32"><span class="var type1" id="S16T6U47">slds</span> = <span class="mxinfo " id="T6:U34"><span class="var type1" id="S14T6U49">output</span>(<span class="mxinfo " id="T59:U36">:</span>,<span class="mxinfo " id="T60:U37"><span class="mxinfo " id="T11:U38">1</span>:<span class="mxinfo " id="T11:U39">3</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="103,27" id="srcline27">27</a></span><span class="line">    <span class="mxinfo " id="T11:U40"><span class="var type1" id="S17T11U56">lays</span> = <span class="mxinfo " id="T11:U42">size(<span class="var type1" id="S16T6U59">slds</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="103,28" id="srcline28">28</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="103,29" id="srcline29">29</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="103,30" id="srcline30">30</a></span><span class="line"><span class="mxinfo " id="T11:U44"><span class="var type1" id="S19T11U63">simXLo</span> = <span class="mxinfo " id="T11:U46"><span class="var type1" id="S6T17U65">simLimits</span>(<span class="mxinfo " id="T28:U48">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="103,31" id="srcline31">31</a></span><span class="line"><span class="mxinfo " id="T11:U49"><span class="var type1" id="S20T11U69">simXHi</span> = <span class="mxinfo " id="T11:U51"><span class="var type1" id="S6T17U71">simLimits</span>(<span class="mxinfo " id="T28:U53">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="103,32" id="srcline32">32</a></span><span class="line"><span class="mxinfo " id="T1:U54"><span class="var type1" id="S21T1U75">middleSection</span> = <span class="mxinfo " id="T1:U56"><span class="var type1" id="S8T6U77">this_data</span>(<span class="mxinfo " id="T59:U58">:</span>,<span class="mxinfo " id="T28:U59">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="103,33" id="srcline33">33</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="103,34" id="srcline34">34</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T26:U60"><span class="var type1" id="S19T11U83">simXLo</span> &lt; <span class="mxinfo " id="T11:U62"><span class="var type1" id="S13T1U85">xdata</span>(<span class="mxinfo " id="T11:U64">1</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="103,35" id="srcline35">35</a></span><span class="line">    <span class="mxinfo " id="T11:U65"><span class="var type1" id="S22T11U89">step</span> = (<span class="mxinfo " id="T11:U67"><span class="mxinfo " id="T11:U68"><span class="var type1" id="S13T1U93">xdata</span>(<span class="mxinfo " id="T11:U70">2</span>)</span>-<span class="mxinfo " id="T11:U71"><span class="var type1" id="S13T1U96">xdata</span>(<span class="mxinfo " id="T11:U73">1</span>)</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="103,36" id="srcline36">36</a></span><span class="line">    <span class="mxinfo " id="T115:U74"><span class="var type1" id="S23T115U100">firstSection</span> = <span class="mxinfo " id="T115:U76">[<span class="var type1" id="S19T11U105">simXLo</span>:<span class="var type1" id="S22T11U106">step</span>:(<span class="mxinfo " id="T11:U79"><span class="mxinfo " id="T11:U80"><span class="var type1" id="S13T1U110">xdata</span>(<span class="mxinfo " id="T11:U82">1</span>)</span>-<span class="var type1" id="S22T11U112">step</span></span>)]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="103,37" id="srcline37">37</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="103,38" id="srcline38">38</a></span><span class="line">    <span class="mxinfo " id="T115:U84"><span class="var type1" id="S23T115U116">firstSection</span> = <span class="mxinfo " id="T23:U86">[]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="103,39" id="srcline39">39</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="103,40" id="srcline40">40</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="103,41" id="srcline41">41</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T26:U87"><span class="var type1" id="S20T11U122">simXHi</span> &gt; <span class="mxinfo " id="T11:U89"><span class="var type1" id="S13T1U124">xdata</span>(<span class="mxinfo " id="T11:U91">end</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="103,42" id="srcline42">42</a></span><span class="line">    <span class="mxinfo " id="T11:U92"><span class="var type1" id="S22T11U129">step</span> = (<span class="mxinfo " id="T11:U94"><span class="mxinfo " id="T11:U95"><span class="var type1" id="S13T1U133">xdata</span>(<span class="mxinfo " id="T11:U97">end</span>)</span>-<span class="mxinfo " id="T11:U98"><span class="var type1" id="S13T1U137">xdata</span>(<span class="mxinfo " id="T11:U100"><span class="mxinfo " id="T11:U101">end</span>-<span class="mxinfo " id="T11:U102">1</span></span>,<span class="mxinfo " id="T11:U103">1</span>)</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="103,43" id="srcline43">43</a></span><span class="line">    <span class="mxinfo " id="T115:U104"><span class="var type1" id="S25T115U145">lastSection</span> = <span class="mxinfo " id="T115:U106">[<span class="mxinfo " id="T11:U107"><span class="mxinfo " id="T11:U108"><span class="var type1" id="S13T1U152">xdata</span>(<span class="mxinfo " id="T11:U110">end</span>,<span class="mxinfo " id="T28:U111">1</span>)</span>+<span class="var type1" id="S22T11U156">step</span></span>:<span class="var type1" id="S22T11U157">step</span>:<span class="var type1" id="S20T11U158">simXHi</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="103,44" id="srcline44">44</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="103,45" id="srcline45">45</a></span><span class="line">    <span class="mxinfo " id="T115:U115"><span class="var type1" id="S25T115U162">lastSection</span> = <span class="mxinfo " id="T23:U117">[]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="103,46" id="srcline46">46</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="103,47" id="srcline47">47</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="103,48" id="srcline48">48</a></span><span class="line"><span class="mxinfo " id="T13:U118"><span class="var type1" id="S26T13U167">simXdata</span> = <span class="mxinfo " id="T13:U120"><span class="mxinfo " id="T1:U121">[<span class="mxinfo " id="T1:U122"><span class="var type1" id="S23T115U172">firstSection</span>(:)</span> ; <span class="var type1" id="S21T1U175">middleSection</span> ; <span class="mxinfo " id="T1:U125"><span class="var type1" id="S25T115U178">lastSection</span>(:)</span>]</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="103,49" id="srcline49">49</a></span><span class="line"><span class="mxinfo " id="T1:U127"><span class="var type1" id="S27T1U182">trueXdata</span> = <span class="mxinfo " id="T1:U129"><span class="var type1" id="S21T1U184">middleSection</span>(:)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="103,50" id="srcline50">50</a></span><span class="line"><span class="mxinfo " id="T60:U131"><span class="var type1" id="S28T60U188">splits</span> = <span class="mxinfo " id="T60:U133">[<span class="mxinfo " id="T11:U134">length(<span class="var type1" id="S23T115U193">firstSection</span>)</span> <span class="mxinfo " id="T11:U136">length(<span class="mxinfo " id="T1:U137"><span class="var type1" id="S21T1U197">middleSection</span>(<span class="mxinfo " id="T59:U139">:</span>,<span class="mxinfo " id="T28:U140">1</span>)</span>)</span> <span class="mxinfo " id="T11:U141">length(<span class="var type1" id="S25T115U202">lastSection</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="103,51" id="srcline51">51</a></span><span class="line"><span class="mxinfo " id="T11:U143"><span class="var type1" id="S30T11U205">repeats</span> = <span class="mxinfo " id="T11:U145"><span class="var type1" id="S7T17U207">repeatLayers</span>(<span class="mxinfo " id="T28:U147">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="103,52" id="srcline52">52</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="103,53" id="srcline53">53</a></span><span class="line"><span class="mxinfo " id="T1:U148"><span class="var type1" id="S31T1U211">simRef</span> = <span class="mxinfo " id="T1:U150"><span class="fcn" id="F463N3:B213">abeles</span>(<span class="var type1" id="S26T13U214">simXdata</span>, <span class="var type1" id="S16T6U215">slds</span>, <span class="var type1" id="S4T11U216">nbairs</span>, <span class="var type1" id="S5T11U217">nbsubs</span>, <span class="var type1" id="S30T11U218">repeats</span>, <span class="var type1" id="S10T11U219">ssubs</span>, <span class="var type1" id="S17T11U220">lays</span>, <span class="mxinfo " id="T11:U158">length(<span class="var type1" id="S26T13U223">simXdata</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="103,54" id="srcline54">54</a></span><span class="line"><span class="mxinfo " id="T1:U160"><span class="var type1" id="S31T1U226">simRef</span> = <span class="mxinfo " id="T1:U162"><span class="fcn" id="F464N15:B228">resolution_polly</span>(<span class="var type1" id="S26T13U229">simXdata</span>,<span class="var type1" id="S31T1U230">simRef</span>,<span class="var type1" id="S12T11U231">res</span>,<span class="mxinfo " id="T11:U166">length(<span class="var type1" id="S26T13U234">simXdata</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="103,55" id="srcline55">55</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="103,56" id="srcline56">56</a></span><span class="line"><span class="mxinfo " id="T11:U168"><span class="var type1" id="S23T11U237">firstSection</span> = <span class="mxinfo " id="T11:U170"><span class="var type1" id="S28T60U239">splits</span>(<span class="mxinfo " id="T28:U172">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="103,57" id="srcline57">57</a></span><span class="line"><span class="mxinfo " id="T11:U173"><span class="var type1" id="S21T11U243">middleSection</span> = <span class="mxinfo " id="T11:U175"><span class="var type1" id="S28T60U245">splits</span>(<span class="mxinfo " id="T28:U177">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="103,58" id="srcline58">58</a></span><span class="line"><span class="mxinfo " id="T1:U178"><span class="var type1" id="S34T1U249">Ref</span> = <span class="var type1" id="S31T1U250">simRef</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="103,59" id="srcline59">59</a></span><span class="line"><span class="mxinfo " id="T1:U181"><span class="var type1" id="S34T1U253">Ref</span> = <span class="mxinfo " id="T1:U183"><span class="var type1" id="S34T1U255">Ref</span>(<span class="mxinfo " id="T1:U185">(<span class="mxinfo " id="T11:U186"><span class="var type1" id="S23T11U259">firstSection</span>+1</span>):(<span class="mxinfo " id="T11:U188"><span class="var type1" id="S23T11U263">firstSection</span>+<span class="var type1" id="S21T11U264">middleSection</span></span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="103,60" id="srcline60">60</a></span><span class="line"><span class="mxinfo " id="T1:U191"><span class="var type1" id="S34T1U267">Ref</span> = <span class="mxinfo " id="T1:U193"><span class="var type1" id="S34T1U269">Ref</span> + <span class="var type1" id="S11T11U270">backgrounds</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="103,61" id="srcline61">61</a></span><span class="line"><span class="mxinfo " id="T3:U196"><span class="var type1" id="S2T3U273">reflectivity</span> = <span class="mxinfo " id="T3:U198">[<span class="mxinfo " id="T1:U199"><span class="var type1" id="S27T1U277">trueXdata</span>(:)</span> <span class="mxinfo " id="T1:U201"><span class="var type1" id="S34T1U280">Ref</span>(:)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="103,62" id="srcline62">62</a></span><span class="line"><span class="mxinfo " id="T1:U203"><span class="var type1" id="S31T1U284">simRef</span> = <span class="mxinfo " id="T1:U205"><span class="var type1" id="S31T1U286">simRef</span> + <span class="var type1" id="S11T11U287">backgrounds</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="103,63" id="srcline63">63</a></span><span class="line"><span class="mxinfo " id="T3:U208"><span class="var type1" id="S3T3U290">Simulation</span> = <span class="mxinfo " id="T3:U210">[<span class="mxinfo " id="T1:U211"><span class="var type1" id="S26T13U294">simXdata</span>'</span> <span class="var type1" id="S31T1U295">simRef</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="103,64" id="srcline64">64</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="103,65" id="srcline65">65</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="103,66" id="srcline66">66</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="103,67" id="srcline67">67</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
