<pre class="code">
<span class="srcline"><span class="lineno"><a href="29,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T71U3">out</span> = makeSLDProfileXY(<span class="var type1" id="S3T4U6">nbair</span>,<span class="var type1" id="S4T4U7">nbsub</span>,<span class="var type1" id="S5T4U8">ssub</span>,<span class="var type1" id="S6T16U9">layers</span>,<span class="var type1" id="S7T4U10">numberOfLayers</span>,<span class="var type1" id="S8T4U11">nrepeats</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="29,2" id="srcline2"> 2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,3" id="srcline3"> 3</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T40:U8"><span class="var type1" id="S7T4U15">numberOfLayers</span>&gt;<span class="mxinfo " id="T4:U10">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="29,4" id="srcline4"> 4</a></span><span class="line">    <span class="mxinfo " id="T4:U11"><span class="var type1" id="S9T4U19">layerThicks</span> = <span class="mxinfo " id="T4:U13">sum(<span class="mxinfo " id="T2:U14"><span class="var type1" id="S6T16U23">layers</span>(<span class="mxinfo " id="T151:U16">:</span>,<span class="mxinfo " id="T42:U17">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,5" id="srcline5"> 5</a></span><span class="line">    <span class="mxinfo " id="T4:U18"><span class="var type1" id="S11T4U28">totalRange</span> = <span class="mxinfo " id="T4:U20">(<span class="mxinfo " id="T4:U21"><span class="var type1" id="S9T4U32">layerThicks</span>*<span class="var type1" id="S8T4U33">nrepeats</span></span>) + <span class="mxinfo " id="T4:U24">150</span></span></span>;  </span></span>
<span class="srcline"><span class="lineno"><a href="29,6" id="srcline6"> 6</a></span><span class="line">    <span class="mxinfo " id="T9:U25"><span class="var type1" id="S12T9U37">x</span> = <span class="mxinfo " id="T9:U27">0:<span class="var type1" id="S11T4U40">totalRange</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,7" id="srcline7"> 7</a></span><span class="line">    <span class="mxinfo " id="T7:U29"><span class="var type1" id="S13T7U43">Lays</span> = <span class="mxinfo " id="T7:U31">zeros(<span class="mxinfo " id="T4:U32">length(<span class="var type1" id="S12T9U48">x</span>)</span>,<span class="mxinfo " id="T4:U34">(<span class="mxinfo " id="T4:U35"><span class="var type1" id="S7T4U52">numberOfLayers</span>*<span class="var type1" id="S8T4U53">nrepeats</span></span>)+<span class="mxinfo " id="T4:U38">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,8" id="srcline8"> 8</a></span><span class="line">    <span class="mxinfo " id="T4:U39"><span class="var type1" id="S16T4U57">boxCen</span> = <span class="mxinfo " id="T4:U41">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,9" id="srcline9"> 9</a></span><span class="line">    <span class="mxinfo " id="T4:U42"><span class="var type1" id="S17T4U61">boxWidth</span> = <span class="mxinfo " id="T4:U44">100</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,10" id="srcline10">10</a></span><span class="line">    <span class="mxinfo " id="T4:U45"><span class="var type1" id="S18T4U65">nextLayRough</span> = <span class="mxinfo " id="T4:U47"><span class="var type1" id="S6T16U67">layers</span>(<span class="mxinfo " id="T4:U49">1</span>,<span class="mxinfo " id="T42:U50">3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,11" id="srcline11">11</a></span><span class="line">    <span class="mxinfo " id="T9:U51"><span class="var type1" id="S19T9U72">airBox</span> = <span class="mxinfo " id="T9:U53"><span class="fcn" id="F158N2:B74">asymconvstep</span>(<span class="var type1" id="S12T9U75">x</span>,<span class="var type1" id="S17T4U76">boxWidth</span>,<span class="var type1" id="S16T4U77">boxCen</span>,<span class="var type1" id="S18T4U78">nextLayRough</span>,<span class="var type1" id="S18T4U79">nextLayRough</span>,<span class="var type1" id="S3T4U80">nbair</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,12" id="srcline12">12</a></span><span class="line">    <span class="mxinfo " id="T4:U60"><span class="var type1" id="S21T4U83">lastBoxEdge</span> = <span class="mxinfo " id="T4:U62"><span class="var type1" id="S16T4U85">boxCen</span> + (<span class="mxinfo " id="T4:U64"><span class="var type1" id="S17T4U88">boxWidth</span>/<span class="mxinfo " id="T4:U66">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,13" id="srcline13">13</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S22T4U92">n</span> = <span class="mxinfo " id="T2:U68"><span class="mxinfo " id="T4:U69">1</span>:<span class="var type1" id="S8T4U95">nrepeats</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="29,14" id="srcline14">14</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S23T4U98">i</span> = <span class="mxinfo " id="T2:U72"><span class="mxinfo " id="T4:U73">1</span>:<span class="var type1" id="S7T4U101">numberOfLayers</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="29,15" id="srcline15">15</a></span><span class="line">            <span class="mxinfo " id="T4:U75"><span class="var type1" id="S24T4U104">thisLayThick</span> = <span class="mxinfo " id="T4:U77"><span class="var type1" id="S6T16U106">layers</span>(<span class="var type1" id="S23T4U107">i</span>,<span class="mxinfo " id="T42:U80">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,16" id="srcline16">16</a></span><span class="line">            <span class="mxinfo " id="T4:U81"><span class="var type1" id="S25T4U111">thisLaySLD</span> = <span class="mxinfo " id="T4:U83"><span class="var type1" id="S6T16U113">layers</span>(<span class="var type1" id="S23T4U114">i</span>,<span class="mxinfo " id="T42:U86">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,17" id="srcline17">17</a></span><span class="line">            <span class="mxinfo " id="T4:U87"><span class="var type1" id="S26T4U118">thisLayRough</span> = <span class="mxinfo " id="T4:U89"><span class="var type1" id="S6T16U120">layers</span>(<span class="var type1" id="S23T4U121">i</span>,<span class="mxinfo " id="T42:U92">3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,18" id="srcline18">18</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T40:U93"><span class="var type1" id="S23T4U126">i</span>&lt;<span class="var type1" id="S7T4U127">numberOfLayers</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="29,19" id="srcline19">19</a></span><span class="line">                <span class="mxinfo " id="T4:U96"><span class="var type1" id="S18T4U130">nextLayRough</span> = <span class="mxinfo " id="T4:U98"><span class="var type1" id="S6T16U132">layers</span>(<span class="mxinfo " id="T4:U100"><span class="var type1" id="S23T4U134">i</span>+<span class="mxinfo " id="T4:U102">1</span></span>,<span class="mxinfo " id="T4:U103">3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,20" id="srcline20">20</a></span><span class="line"><span class="comment">%             elseif (i == numberOfLayers) &amp;&amp; (n &lt; nrepeats)</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,21" id="srcline21">21</a></span><span class="line"><span class="comment">%                 nextLayRough = layers(1,3);</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,22" id="srcline22">22</a></span><span class="line">            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,23" id="srcline23">23</a></span><span class="line">                <span class="mxinfo " id="T4:U104"><span class="var type1" id="S18T4U140">nextLayRough</span> = <span class="var type1" id="S5T4U141">ssub</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,24" id="srcline24">24</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,25" id="srcline25">25</a></span><span class="line">            <span class="mxinfo " id="T4:U107"><span class="var type1" id="S27T4U144">thisBoxCentre</span> = <span class="mxinfo " id="T4:U109"><span class="var type1" id="S21T4U146">lastBoxEdge</span> + (<span class="mxinfo " id="T4:U111"><span class="var type1" id="S24T4U149">thisLayThick</span>/<span class="mxinfo " id="T4:U113">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,26" id="srcline26">26</a></span><span class="line">            <span class="mxinfo " id="T9:U114"><span class="var type1" id="S28T9U153">thisBox</span> = <span class="mxinfo " id="T9:U116"><span class="fcn" id="F244N2:B155">asymconvstep</span>(<span class="var type1" id="S12T9U156">x</span>,<span class="var type1" id="S24T4U157">thisLayThick</span>,<span class="var type1" id="S27T4U158">thisBoxCentre</span>,<span class="var type1" id="S26T4U159">thisLayRough</span>,<span class="var type1" id="S18T4U160">nextLayRough</span>,<span class="var type1" id="S25T4U161">thisLaySLD</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,27" id="srcline27">27</a></span><span class="line">            <span class="mxinfo " id="T2:U123"><span class="mxinfo " id="T2:U124"><span class="var type1" id="S13T7U165">Lays</span>(<span class="mxinfo " id="T151:U126">:</span>,<span class="mxinfo " id="T4:U127"><span class="var type1" id="S23T4U168">i</span>+(<span class="mxinfo " id="T4:U129"><span class="var type1" id="S7T4U171">numberOfLayers</span>*(<span class="mxinfo " id="T4:U131"><span class="var type1" id="S22T4U174">n</span>-<span class="mxinfo " id="T4:U133">1</span></span>)</span>)</span>)</span> = <span class="var type1" id="S28T9U176">thisBox</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,28" id="srcline28">28</a></span><span class="line">            <span class="mxinfo " id="T4:U135"><span class="var type1" id="S21T4U179">lastBoxEdge</span> = <span class="mxinfo " id="T4:U137"><span class="var type1" id="S27T4U181">thisBoxCentre</span> + (<span class="mxinfo " id="T4:U139"><span class="var type1" id="S24T4U184">thisLayThick</span>/<span class="mxinfo " id="T4:U141">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,29" id="srcline29">29</a></span><span class="line">            <span class="comment">%plot(x,Lays(:,i));</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,30" id="srcline30">30</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,31" id="srcline31">31</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,32" id="srcline32">32</a></span><span class="line">    <span class="mxinfo " id="T4:U142"><span class="var type1" id="S26T4U188">thisLayRough</span> = <span class="var type1" id="S18T4U189">nextLayRough</span></span>;<span class="comment">%layers(end,3);</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,33" id="srcline33">33</a></span><span class="line">    <span class="mxinfo " id="T4:U145"><span class="var type1" id="S24T4U192">thisLayThick</span> = <span class="mxinfo " id="T4:U147">(<span class="mxinfo " id="T4:U148"><span class="mxinfo " id="T4:U149"><span class="var type1" id="S12T9U197">x</span>(<span class="mxinfo " id="T4:U151">end</span>)</span>-<span class="var type1" id="S21T4U200">lastBoxEdge</span></span>)*<span class="mxinfo " id="T4:U153">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,34" id="srcline34">34</a></span><span class="line">    <span class="mxinfo " id="T4:U154"><span class="var type1" id="S25T4U204">thisLaySLD</span> = <span class="var type1" id="S4T4U205">nbsub</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,35" id="srcline35">35</a></span><span class="line">    <span class="mxinfo " id="T4:U157"><span class="var type1" id="S18T4U208">nextLayRough</span> = <span class="var type1" id="S5T4U209">ssub</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,36" id="srcline36">36</a></span><span class="line">    <span class="mxinfo " id="T4:U160"><span class="var type1" id="S27T4U212">thisBoxCentre</span> = <span class="mxinfo " id="T4:U162"><span class="var type1" id="S12T9U214">x</span>(<span class="mxinfo " id="T4:U164">end</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,37" id="srcline37">37</a></span><span class="line">    <span class="mxinfo " id="T2:U165"><span class="mxinfo " id="T2:U166"><span class="var type1" id="S13T7U220">Lays</span>(<span class="mxinfo " id="T151:U168">:</span>,<span class="mxinfo " id="T4:U169">(<span class="mxinfo " id="T4:U170"><span class="var type1" id="S7T4U225">numberOfLayers</span>*<span class="var type1" id="S8T4U226">nrepeats</span></span>)+<span class="mxinfo " id="T4:U173">1</span></span>)</span> = <span class="mxinfo " id="T9:U174"><span class="fcn" id="F244N2:B229">asymconvstep</span>(<span class="var type1" id="S12T9U230">x</span>,<span class="var type1" id="S24T4U231">thisLayThick</span>,<span class="var type1" id="S27T4U232">thisBoxCentre</span>,<span class="var type1" id="S26T4U233">thisLayRough</span>,<span class="var type1" id="S18T4U234">nextLayRough</span>,<span class="var type1" id="S25T4U235">thisLaySLD</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,38" id="srcline38">38</a></span><span class="line">    <span class="comment">%plot(x,Lays(:,(numberOfLayers*nrepeats)+1))</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,39" id="srcline39">39</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="29,40" id="srcline40">40</a></span><span class="line">    <span class="mxinfo " id="T2:U181"><span class="mxinfo " id="T2:U182"><span class="var type1" id="S13T7U239">Lays</span>(<span class="mxinfo " id="T151:U184">:</span>,<span class="mxinfo " id="T4:U185">(<span class="mxinfo " id="T4:U186"><span class="var type1" id="S7T4U244">numberOfLayers</span>*<span class="var type1" id="S8T4U245">nrepeats</span></span>)+<span class="mxinfo " id="T4:U189">2</span></span>)</span> = <span class="var type1" id="S19T9U247">airBox</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,41" id="srcline41">41</a></span><span class="line">    <span class="comment">%plot(x,Lays(:,(numberOfLayers*nrepeats)+2))</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,42" id="srcline42">42</a></span><span class="line">    <span class="mxinfo " id="T7:U191"><span class="var type1" id="S30T7U250">SLD</span> = <span class="mxinfo " id="T2:U193">sum(<span class="var type1" id="S13T7U253">Lays</span>,2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,43" id="srcline43">43</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,44" id="srcline44">44</a></span><span class="line">    <span class="mxinfo " id="T9:U195"><span class="var type1" id="S12T9U258">x</span> = <span class="mxinfo " id="T156:U197">0:100</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,45" id="srcline45">45</a></span><span class="line">    <span class="mxinfo " id="T4:U198"><span class="var type1" id="S31T4U264">subsBoxCen</span> = <span class="mxinfo " id="T4:U200">max(<span class="var type1" id="S12T9U267">x</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,46" id="srcline46">46</a></span><span class="line">    <span class="mxinfo " id="T4:U202"><span class="var type1" id="S33T4U270">airBoxCen</span> = <span class="mxinfo " id="T4:U204">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,47" id="srcline47">47</a></span><span class="line">    <span class="mxinfo " id="T4:U205"><span class="var type1" id="S34T4U274">widths</span> = <span class="mxinfo " id="T4:U207">max(<span class="var type1" id="S12T9U277">x</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,48" id="srcline48">48</a></span><span class="line">    <span class="mxinfo " id="T9:U209"><span class="var type1" id="S19T9U280">airBox</span> = <span class="mxinfo " id="T9:U211"><span class="fcn" id="F280N2:B282">asymconvstep</span>(<span class="var type1" id="S12T9U283">x</span>,<span class="var type1" id="S34T4U284">widths</span>,<span class="var type1" id="S33T4U285">airBoxCen</span>,<span class="var type1" id="S5T4U286">ssub</span>,<span class="var type1" id="S5T4U287">ssub</span>,<span class="var type1" id="S3T4U288">nbair</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,49" id="srcline49">49</a></span><span class="line">    <span class="mxinfo " id="T9:U218"><span class="var type1" id="S35T9U291">subBox</span> = <span class="mxinfo " id="T9:U220"><span class="fcn" id="F280N2:B293">asymconvstep</span>(<span class="var type1" id="S12T9U294">x</span>,<span class="var type1" id="S34T4U295">widths</span>,<span class="var type1" id="S31T4U296">subsBoxCen</span>,<span class="var type1" id="S5T4U297">ssub</span>,<span class="var type1" id="S5T4U298">ssub</span>,<span class="var type1" id="S4T4U299">nbsub</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,50" id="srcline50">50</a></span><span class="line">    <span class="mxinfo " id="T7:U227"><span class="var type1" id="S30T7U302">SLD</span> = <span class="mxinfo " id="T9:U229"><span class="var type1" id="S19T9U304">airBox</span> + <span class="var type1" id="S35T9U305">subBox</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,51" id="srcline51">51</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,52" id="srcline52">52</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,53" id="srcline53">53</a></span><span class="line"><span class="comment">%plot(x,SLD)</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,54" id="srcline54">54</a></span><span class="line"><span class="mxinfo " id="T71:U232"><span class="var type1" id="S2T71U308">out</span> = <span class="mxinfo " id="T71:U234">[<span class="mxinfo " id="T2:U235"><span class="var type1" id="S12T9U312">x</span>(:)</span>,<span class="mxinfo " id="T2:U237"><span class="var type1" id="S30T7U315">SLD</span>(:)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,55" id="srcline55">55</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,56" id="srcline56">56</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,57" id="srcline57">57</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,58" id="srcline58">58</a></span><span class="line"></span></span>
</pre>
