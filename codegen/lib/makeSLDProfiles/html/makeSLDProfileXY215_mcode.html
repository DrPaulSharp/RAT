<pre class="code">
<span class="srcline"><span class="lineno"><a href="61,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T1U3">out</span> = makeSLDProfileXY(<span class="var type1" id="S3T2U6">nbair</span>,<span class="var type1" id="S4T2U7">nbsub</span>,<span class="var type1" id="S5T2U8">ssub</span>,<span class="var type1" id="S6T3U9">layers</span>,<span class="var type1" id="S7T2U10">numberOfLayers</span>,<span class="var type1" id="S8T2U11">nrepeats</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="61,2" id="srcline2"> 2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="61,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">%coder.extrinsic('asymconvstep_mex');</span></span></span>
<span class="srcline"><span class="lineno"><a href="61,4" id="srcline4"> 4</a></span><span class="line"><span class="mxinfo " id="T2:U8"><span class="var type1" id="S9T2U14">nextLayRough</span> = <span class="var type1" id="S5T2U15">ssub</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="61,5" id="srcline5"> 5</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T5:U11"><span class="var type1" id="S7T2U19">numberOfLayers</span>&gt;<span class="mxinfo " id="T2:U13">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="61,6" id="srcline6"> 6</a></span><span class="line">    <span class="mxinfo " id="T2:U14"><span class="var type1" id="S10T2U23">layerThicks</span> = <span class="mxinfo " id="T2:U16">sum(<span class="mxinfo " id="T10:U17"><span class="var type1" id="S6T3U27">layers</span>(<span class="mxinfo " id="T53:U19">:</span>,<span class="mxinfo " id="T6:U20">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="61,7" id="srcline7"> 7</a></span><span class="line">    <span class="mxinfo " id="T2:U21"><span class="var type1" id="S12T2U32">totalRange</span> = <span class="mxinfo " id="T2:U23">(<span class="mxinfo " id="T2:U24"><span class="var type1" id="S10T2U36">layerThicks</span>*<span class="var type1" id="S8T2U37">nrepeats</span></span>) + <span class="mxinfo " id="T2:U27">150</span></span></span>;  </span></span>
<span class="srcline"><span class="lineno"><a href="61,8" id="srcline8"> 8</a></span><span class="line">    <span class="mxinfo " id="T20:U28"><span class="var type1" id="S13T20U41">x</span> = <span class="mxinfo " id="T20:U30">0:<span class="var type1" id="S12T2U44">totalRange</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="61,9" id="srcline9"> 9</a></span><span class="line">    <span class="mxinfo " id="T40:U32"><span class="var type1" id="S14T40U47">Lays</span> = <span class="mxinfo " id="T40:U34">zeros(<span class="mxinfo " id="T2:U35">length(<span class="var type1" id="S13T20U52">x</span>)</span>,<span class="mxinfo " id="T2:U37">(<span class="mxinfo " id="T2:U38"><span class="var type1" id="S7T2U56">numberOfLayers</span>*<span class="var type1" id="S8T2U57">nrepeats</span></span>)+<span class="mxinfo " id="T2:U41">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="61,10" id="srcline10">10</a></span><span class="line">    <span class="mxinfo " id="T2:U42"><span class="var type1" id="S17T2U61">boxCen</span> = <span class="mxinfo " id="T2:U44">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="61,11" id="srcline11">11</a></span><span class="line">    <span class="mxinfo " id="T2:U45"><span class="var type1" id="S18T2U65">boxWidth</span> = <span class="mxinfo " id="T2:U47">100</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="61,12" id="srcline12">12</a></span><span class="line">    <span class="mxinfo " id="T2:U48"><span class="var type1" id="S19T2U69">boxRough</span> = <span class="mxinfo " id="T2:U50"><span class="var type1" id="S6T3U71">layers</span>(<span class="mxinfo " id="T2:U52">1</span>,<span class="mxinfo " id="T6:U53">3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="61,13" id="srcline13">13</a></span><span class="line">    <span class="mxinfo " id="T20:U54"><span class="var type1" id="S20T20U76">airBox</span> = <span class="mxinfo " id="T20:U56"><span class="fcn" id="F137N2:B78">asymconvstep</span>(<span class="var type1" id="S13T20U79">x</span>,<span class="var type1" id="S18T2U80">boxWidth</span>,<span class="var type1" id="S17T2U81">boxCen</span>,<span class="var type1" id="S19T2U82">boxRough</span>,<span class="var type1" id="S19T2U83">boxRough</span>,<span class="var type1" id="S3T2U84">nbair</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="61,14" id="srcline14">14</a></span><span class="line">    <span class="mxinfo " id="T2:U63"><span class="var type1" id="S22T2U87">lastBoxEdge</span> = <span class="mxinfo " id="T2:U65"><span class="var type1" id="S17T2U89">boxCen</span> + (<span class="mxinfo " id="T2:U67"><span class="var type1" id="S18T2U92">boxWidth</span>/<span class="mxinfo " id="T2:U69">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="61,15" id="srcline15">15</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S23T2U96">n</span> = <span class="mxinfo " id="T2:U71">1</span>:<span class="var type1" id="S8T2U99">nrepeats</span></span></span>
<span class="srcline"><span class="lineno"><a href="61,16" id="srcline16">16</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S24T2U102">i</span> = <span class="mxinfo " id="T2:U74">1</span>:<span class="var type1" id="S7T2U105">numberOfLayers</span></span></span>
<span class="srcline"><span class="lineno"><a href="61,17" id="srcline17">17</a></span><span class="line">            <span class="mxinfo " id="T2:U76"><span class="var type1" id="S25T2U108">thisLayThick</span> = <span class="mxinfo " id="T2:U78"><span class="var type1" id="S6T3U110">layers</span>(<span class="var type1" id="S24T2U111">i</span>,<span class="mxinfo " id="T6:U81">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="61,18" id="srcline18">18</a></span><span class="line">            <span class="mxinfo " id="T2:U82"><span class="var type1" id="S26T2U115">thisLaySLD</span> = <span class="mxinfo " id="T2:U84"><span class="var type1" id="S6T3U117">layers</span>(<span class="var type1" id="S24T2U118">i</span>,<span class="mxinfo " id="T6:U87">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="61,19" id="srcline19">19</a></span><span class="line">            <span class="mxinfo " id="T2:U88"><span class="var type1" id="S27T2U122">thisLayRough</span> = <span class="mxinfo " id="T2:U90"><span class="var type1" id="S6T3U124">layers</span>(<span class="var type1" id="S24T2U125">i</span>,<span class="mxinfo " id="T6:U93">3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="61,20" id="srcline20">20</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T5:U94"><span class="var type1" id="S24T2U130">i</span>&lt;<span class="var type1" id="S7T2U131">numberOfLayers</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="61,21" id="srcline21">21</a></span><span class="line">                <span class="mxinfo " id="T2:U97"><span class="var type1" id="S9T2U134">nextLayRough</span> = <span class="mxinfo " id="T2:U99"><span class="var type1" id="S6T3U136">layers</span>(<span class="mxinfo " id="T2:U101"><span class="var type1" id="S24T2U138">i</span>+<span class="mxinfo " id="T2:U103">1</span></span>,<span class="mxinfo " id="T2:U104">3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="61,22" id="srcline22">22</a></span><span class="line">            <span class="keyword">elseif</span> (<span class="mxinfo " id="T5:U105"><span class="var type1" id="S24T2U145">i</span> == <span class="var type1" id="S7T2U146">numberOfLayers</span></span>) &amp;&amp; (<span class="mxinfo " id="T5:U108"><span class="var type1" id="S23T2U149">n</span> &lt; <span class="var type1" id="S8T2U150">nrepeats</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="61,23" id="srcline23">23</a></span><span class="line">                <span class="mxinfo " id="T2:U111"><span class="var type1" id="S9T2U153">nextLayRough</span> = <span class="mxinfo " id="T2:U113"><span class="var type1" id="S6T3U155">layers</span>(<span class="mxinfo " id="T2:U115">1</span>,<span class="mxinfo " id="T2:U116">3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="61,24" id="srcline24">24</a></span><span class="line">            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="61,25" id="srcline25">25</a></span><span class="line">                <span class="mxinfo " id="T2:U117"><span class="var type1" id="S9T2U161">nextLayRough</span> = <span class="mxinfo " id="T2:U119"><span class="var type1" id="S6T3U163">layers</span>(<span class="mxinfo " id="T2:U121">1</span>,<span class="mxinfo " id="T2:U122">3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="61,26" id="srcline26">26</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="61,27" id="srcline27">27</a></span><span class="line">            <span class="mxinfo " id="T2:U123"><span class="var type1" id="S28T2U168">thisBoxCentre</span> = <span class="mxinfo " id="T2:U125"><span class="var type1" id="S22T2U170">lastBoxEdge</span> + (<span class="mxinfo " id="T2:U127"><span class="var type1" id="S25T2U173">thisLayThick</span>/<span class="mxinfo " id="T2:U129">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="61,28" id="srcline28">28</a></span><span class="line">            <span class="mxinfo " id="T10:U130"><span class="mxinfo " id="T10:U131"><span class="var type1" id="S14T40U178">Lays</span>(<span class="mxinfo " id="T53:U133">:</span>,<span class="mxinfo " id="T2:U134"><span class="var type1" id="S24T2U181">i</span>+(<span class="mxinfo " id="T2:U136"><span class="var type1" id="S7T2U184">numberOfLayers</span>*(<span class="mxinfo " id="T2:U138"><span class="var type1" id="S23T2U187">n</span>-<span class="mxinfo " id="T2:U140">1</span></span>)</span>)</span>)</span> = <span class="mxinfo " id="T10:U141"><span class="fcn" id="F147N2:B190">asymconvstep</span>(<span class="mxinfo " id="T10:U142"><span class="var type1" id="S13T20U192">x</span>'</span>,<span class="var type1" id="S25T2U193">thisLayThick</span>,<span class="var type1" id="S28T2U194">thisBoxCentre</span>,<span class="var type1" id="S27T2U195">thisLayRough</span>,<span class="var type1" id="S9T2U196">nextLayRough</span>,<span class="var type1" id="S26T2U197">thisLaySLD</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="61,29" id="srcline29">29</a></span><span class="line">            <span class="mxinfo " id="T2:U149"><span class="var type1" id="S22T2U200">lastBoxEdge</span> = <span class="mxinfo " id="T2:U151"><span class="var type1" id="S28T2U202">thisBoxCentre</span> + (<span class="mxinfo " id="T2:U153"><span class="var type1" id="S25T2U205">thisLayThick</span>/<span class="mxinfo " id="T2:U155">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="61,30" id="srcline30">30</a></span><span class="line">            <span class="comment">%plot(x,Lays(:,i));</span></span></span>
<span class="srcline"><span class="lineno"><a href="61,31" id="srcline31">31</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="61,32" id="srcline32">32</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="61,33" id="srcline33">33</a></span><span class="line">    <span class="mxinfo " id="T2:U156"><span class="var type1" id="S27T2U209">thisLayRough</span> = <span class="var type1" id="S9T2U210">nextLayRough</span></span>;<span class="comment">%layers(end,3);</span></span></span>
<span class="srcline"><span class="lineno"><a href="61,34" id="srcline34">34</a></span><span class="line">    <span class="mxinfo " id="T2:U159"><span class="var type1" id="S25T2U213">thisLayThick</span> = <span class="mxinfo " id="T2:U161">(<span class="mxinfo " id="T2:U162"><span class="mxinfo " id="T2:U163"><span class="var type1" id="S13T20U218">x</span>(<span class="mxinfo " id="T2:U165">end</span>)</span>-<span class="var type1" id="S22T2U221">lastBoxEdge</span></span>)*<span class="mxinfo " id="T2:U167">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="61,35" id="srcline35">35</a></span><span class="line">    <span class="mxinfo " id="T2:U168"><span class="var type1" id="S26T2U225">thisLaySLD</span> = <span class="var type1" id="S4T2U226">nbsub</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="61,36" id="srcline36">36</a></span><span class="line">    <span class="mxinfo " id="T2:U171"><span class="var type1" id="S9T2U229">nextLayRough</span> = <span class="var type1" id="S5T2U230">ssub</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="61,37" id="srcline37">37</a></span><span class="line">    <span class="mxinfo " id="T2:U174"><span class="var type1" id="S28T2U233">thisBoxCentre</span> = <span class="mxinfo " id="T2:U176"><span class="var type1" id="S13T20U235">x</span>(<span class="mxinfo " id="T2:U178">end</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="61,38" id="srcline38">38</a></span><span class="line">    <span class="mxinfo " id="T10:U179"><span class="mxinfo " id="T10:U180"><span class="var type1" id="S14T40U241">Lays</span>(<span class="mxinfo " id="T53:U182">:</span>,<span class="mxinfo " id="T2:U183">(<span class="mxinfo " id="T2:U184"><span class="var type1" id="S7T2U246">numberOfLayers</span>*<span class="var type1" id="S8T2U247">nrepeats</span></span>)+<span class="mxinfo " id="T2:U187">1</span></span>)</span> = <span class="mxinfo " id="T10:U188"><span class="fcn" id="F147N2:B250">asymconvstep</span>(<span class="mxinfo " id="T10:U189"><span class="var type1" id="S13T20U252">x</span>'</span>,<span class="var type1" id="S25T2U253">thisLayThick</span>,<span class="var type1" id="S28T2U254">thisBoxCentre</span>,<span class="var type1" id="S27T2U255">thisLayRough</span>,<span class="var type1" id="S9T2U256">nextLayRough</span>,<span class="var type1" id="S26T2U257">thisLaySLD</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="61,39" id="srcline39">39</a></span><span class="line">    <span class="comment">%plot(x,Lays(:,(numberOfLayers*nrepeats)+1))</span></span></span>
<span class="srcline"><span class="lineno"><a href="61,40" id="srcline40">40</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="61,41" id="srcline41">41</a></span><span class="line">    <span class="mxinfo " id="T10:U196"><span class="mxinfo " id="T10:U197"><span class="var type1" id="S14T40U261">Lays</span>(<span class="mxinfo " id="T53:U199">:</span>,<span class="mxinfo " id="T2:U200">(<span class="mxinfo " id="T2:U201"><span class="var type1" id="S7T2U266">numberOfLayers</span>*<span class="var type1" id="S8T2U267">nrepeats</span></span>)+<span class="mxinfo " id="T2:U204">2</span></span>)</span> = <span class="var type1" id="S20T20U269">airBox</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="61,42" id="srcline42">42</a></span><span class="line">    <span class="comment">%plot(x,Lays(:,(numberOfLayers*nrepeats)+2))</span></span></span>
<span class="srcline"><span class="lineno"><a href="61,43" id="srcline43">43</a></span><span class="line">    <span class="mxinfo " id="T54:U206"><span class="var type1" id="S30T54U272">SLD</span> = <span class="mxinfo " id="T10:U208">sum(<span class="var type1" id="S14T40U275">Lays</span>,2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="61,44" id="srcline44">44</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="61,45" id="srcline45">45</a></span><span class="line">    <span class="mxinfo " id="T20:U210"><span class="var type1" id="S13T20U280">x</span> = <span class="mxinfo " id="T41:U212">0:100</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="61,46" id="srcline46">46</a></span><span class="line">    <span class="mxinfo " id="T2:U213"><span class="var type1" id="S31T2U286">subsBoxCen</span> = <span class="mxinfo " id="T2:U215">max(<span class="var type1" id="S13T20U289">x</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="61,47" id="srcline47">47</a></span><span class="line">    <span class="mxinfo " id="T2:U217"><span class="var type1" id="S33T2U292">airBoxCen</span> = <span class="mxinfo " id="T2:U219">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="61,48" id="srcline48">48</a></span><span class="line">    <span class="mxinfo " id="T2:U220"><span class="var type1" id="S34T2U296">widths</span> = <span class="mxinfo " id="T2:U222">max(<span class="var type1" id="S13T20U299">x</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="61,49" id="srcline49">49</a></span><span class="line">    <span class="mxinfo " id="T20:U224"><span class="var type1" id="S20T20U302">airBox</span> = <span class="mxinfo " id="T43:U226"><span class="fcn" id="F183N2:B304">asymconvstep</span>(<span class="var type1" id="S13T20U305">x</span>,<span class="var type1" id="S34T2U306">widths</span>,<span class="var type1" id="S33T2U307">airBoxCen</span>,<span class="var type1" id="S5T2U308">ssub</span>,<span class="var type1" id="S5T2U309">ssub</span>,<span class="var type1" id="S3T2U310">nbair</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="61,50" id="srcline50">50</a></span><span class="line">    <span class="mxinfo " id="T43:U233"><span class="var type1" id="S35T43U313">subBox</span> = <span class="mxinfo " id="T43:U235"><span class="fcn" id="F183N2:B315">asymconvstep</span>(<span class="var type1" id="S13T20U316">x</span>,<span class="var type1" id="S34T2U317">widths</span>,<span class="var type1" id="S31T2U318">subsBoxCen</span>,<span class="var type1" id="S5T2U319">ssub</span>,<span class="var type1" id="S5T2U320">ssub</span>,<span class="var type1" id="S4T2U321">nbsub</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="61,51" id="srcline51">51</a></span><span class="line">    <span class="mxinfo " id="T54:U242"><span class="var type1" id="S30T54U324">SLD</span> = <span class="mxinfo " id="T43:U244"><span class="var type1" id="S20T20U326">airBox</span> + <span class="var type1" id="S35T43U327">subBox</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="61,52" id="srcline52">52</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="61,53" id="srcline53">53</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="61,54" id="srcline54">54</a></span><span class="line"><span class="comment">%plot(x,SLD)</span></span></span>
<span class="srcline"><span class="lineno"><a href="61,55" id="srcline55">55</a></span><span class="line"><span class="mxinfo " id="T1:U247"><span class="var type1" id="S2T1U330">out</span> = <span class="mxinfo " id="T1:U249">[<span class="mxinfo " id="T10:U250"><span class="var type1" id="S13T20U334">x</span>(:)</span>,<span class="mxinfo " id="T10:U252"><span class="var type1" id="S30T54U337">SLD</span>(:)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="61,56" id="srcline56">56</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="61,57" id="srcline57">57</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="61,58" id="srcline58">58</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="61,59" id="srcline59">59</a></span><span class="line"></span></span>
</pre>
