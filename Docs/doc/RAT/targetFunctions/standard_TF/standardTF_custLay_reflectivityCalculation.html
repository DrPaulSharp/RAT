<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of standardTF_custLay_reflectivityCalculation</title>
  <meta name="keywords" content="standardTF_custLay_reflectivityCalculation">
  <meta name="description" content="">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- # RAT --><!-- # targetFunctions --><!-- menu.html standard_TF -->
<h1>standardTF_custLay_reflectivityCalculation
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong></strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [problem,reflectivity,Simulation,shifted_data,layerSlds,sldProfiles,allLayers] = standardTF_custLay_reflectivityCalculation(problemDef,problemDef_cells,problemDef_limits,controls) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../RAT/API/RAT_parse_cells.html" class="code" title="function [repeatLayers,allData,dataLimits,simLimits,contrastLayers,layersDetails] = RAT_parse_cells(problemDef_cells)">RAT_parse_cells</a>	</li><li><a href="../../../RAT/targetFunctions/standard_TF/standardTF_custLay/standardTF_custlay_paraContrasts.html" class="code" title="function [outSsubs,backgs,qshifts,sfs,nbas,nbss,resols,chis,reflectivity,Simulation,shifted_data,layerSlds,sldProfiles,allLayers,allRoughs] =standardTF_custlay_single(resample,numberOfContrasts,geometry,repeatLayers,cBacks,cShifts,cScales,cNbas,cNbss,cRes,backs,shifts,sf,nba,nbs,res,dataPresent,allData,dataLimits,simLimits,nParams,params,contrastLayers,numberOfLayers,layersDetails,problemDef_limits,fname,lang,path,backsType,calcSld)">standardTF_custlay_paraContrasts</a>	Pre-Allocation of output arrays...</li><li><a href="../../../RAT/targetFunctions/standard_TF/standardTF_custLay/standardTF_custlay_paraContrasts.html" class="code" title="function [outSsubs,backgs,qshifts,sfs,nbas,nbss,resols,chis,reflectivity,Simulation,shifted_data,layerSlds,sldProfiles,allLayers,allRoughs] =standardTF_custlay_single(resample,numberOfContrasts,geometry,repeatLayers,cBacks,cShifts,cScales,cNbas,cNbss,cRes,backs,shifts,sf,nba,nbs,res,dataPresent,allData,dataLimits,simLimits,nParams,params,contrastLayers,numberOfLayers,layersDetails,problemDef_limits,fname,lang,path,backsType,calcSld)">standardTF_custlay_paraContrasts</a>	Pre-Allocation of output arrays...</li><li><a href="../../../RAT/targetFunctions/standard_TF/standardTF_custLay/standardTF_custlay_paraPoints.html" class="code" title="function [outSsubs,backgs,qshifts,sfs,nbas,nbss,resols,chis,reflectivity,Simulation,shifted_data,layerSlds,sldProfiles,allLayers,allRoughs] =standardTF_custlay_paraPoints(resample,numberOfContrasts,geometry,repeatLayers,cBacks,cShifts,cScales,cNbas,cNbss,cRes,backs,shifts,sf,nba,nbs,res,dataPresent,allData,dataLimits,simLimits,nParams,params,contrastLayers,numberOfLayers,layersDetails,problemDef_limits,fname,lang,path,backsType,calcSld)">standardTF_custlay_paraPoints</a>	Pre-Allocation of output arrays...</li><li><a href="../../../RAT/targetFunctions/standard_TF/standardTF_custLay/standardTF_custlay_paraPoints.html" class="code" title="function [outSsubs,backgs,qshifts,sfs,nbas,nbss,resols,chis,reflectivity,Simulation,shifted_data,layerSlds,sldProfiles,allLayers,allRoughs] =standardTF_custlay_paraPoints(resample,numberOfContrasts,geometry,repeatLayers,cBacks,cShifts,cScales,cNbas,cNbss,cRes,backs,shifts,sf,nba,nbs,res,dataPresent,allData,dataLimits,simLimits,nParams,params,contrastLayers,numberOfLayers,layersDetails,problemDef_limits,fname,lang,path,backsType,calcSld)">standardTF_custlay_paraPoints</a>	Pre-Allocation of output arrays...</li><li><a href="../../../RAT/targetFunctions/standard_TF/standardTF_custLay/standardTF_custlay_single.html" class="code" title="function [outSsubs,backgs,qshifts,sfs,nbas,nbss,resols,chis,reflectivity,Simulation,shifted_data,layerSlds,sldProfiles,allLayers,allRoughs] =standardTF_custlay_single(resample,numberOfContrasts,geometry,repeatLayers,cBacks,cShifts,cScales,cNbas,cNbss,cRes,backs,shifts,sf,nba,nbs,res,dataPresent,allData,dataLimits,simLimits,nParams,params,contrastLayers,numberOfLayers,layersDetails,problemDef_limits,fname,lang,path,backsType,calcSld)">standardTF_custlay_single</a>	Pre-Allocation of output arrays...</li><li><a href="../../../RAT/targetFunctions/standard_TF/standardTF_custLay/standardTF_custlay_single.html" class="code" title="function [outSsubs,backgs,qshifts,sfs,nbas,nbss,resols,chis,reflectivity,Simulation,shifted_data,layerSlds,sldProfiles,allLayers,allRoughs] =standardTF_custlay_single(resample,numberOfContrasts,geometry,repeatLayers,cBacks,cShifts,cScales,cNbas,cNbss,cRes,backs,shifts,sf,nba,nbs,res,dataPresent,allData,dataLimits,simLimits,nParams,params,contrastLayers,numberOfLayers,layersDetails,problemDef_limits,fname,lang,path,backsType,calcSld)">standardTF_custlay_single</a>	Pre-Allocation of output arrays...</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="standardTF_reflectivityCalculation.html" class="code" title="function [problem,reflectivity,Simulation,shifted_data,layerSlds,sldProfiles,allLayers] = standardTF_reflectivityCalculation(problemDef,problemDef_cells,problemDef_limits,controls)">standardTF_reflectivityCalculation</a>	Decide what kind of calculation it is and call the appropriate one</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [problem,reflectivity,Simulation,shifted_data,layerSlds,sldProfiles,allLayers] = standardTF_custLay_reflectivityCalculation(problemDef,problemDef_cells,problemDef_limits,controls)</a>
0002 
0003 
0004 [repeatLayers,<span class="keyword">...</span>
0005  allData,<span class="keyword">...</span>
0006  dataLimits,<span class="keyword">...</span>
0007  simLimits,<span class="keyword">...</span>
0008  contrastLayers,<span class="keyword">...</span>
0009  layersDetails] = <a href="../../../RAT/API/RAT_parse_cells.html" class="code" title="function [repeatLayers,allData,dataLimits,simLimits,contrastLayers,layersDetails] = RAT_parse_cells(problemDef_cells)">RAT_parse_cells</a>(problemDef_cells);
0010 
0011 
0012 <span class="comment">%Extract individual parameters from problemDef</span>
0013 res = problemDef.resample;
0014 numberOfContrasts = problemDef.numberOfContrasts;
0015 geometry = problemDef.geometry;
0016 <span class="comment">%nbairs = problemDef.nbairs;</span>
0017 <span class="comment">%nbsubs = problemDef.nbsubs;</span>
0018 <span class="comment">%repeats = problemDef.repeatLayers;</span>
0019 cBacks = problemDef.contrastBacks;
0020 cShifts = problemDef.contrastShifts;
0021 cScales = problemDef.contrastScales;
0022 cNbas = problemDef.contrastNbas;
0023 cNbss = problemDef.contrastNbss;
0024 cRes = problemDef.contrastRes;
0025 backs = problemDef.backs;
0026 shifts = problemDef.shifts;
0027 sf = problemDef.sf;
0028 nba = problemDef.nba;
0029 nbs = problemDef.nbs;
0030 res = problemDef.res;
0031 dataPresent = problemDef.dataPresent;
0032 <span class="comment">%allData = problemDef.allData;</span>
0033 <span class="comment">%dataLimits = problemDef.dataLimits;</span>
0034 <span class="comment">%simLimits = problemDef.simLimits;</span>
0035 <span class="comment">%repeatLayers = problemDef.repeatLayers;</span>
0036 nParams = length(problemDef.params);
0037 params = problemDef.params;
0038 <span class="comment">%contrastLayers = problemDef.contrastLayers;</span>
0039 numberOfLayers = problemDef.numberOfLayers;
0040 <span class="comment">%layersDetails = problemDef.layersDetails;</span>
0041 resample = problemDef.resample;
0042 fname = problemDef.modelFilename;
0043 lang  = problemDef.modelLanguage;
0044 path = problemDef.path;
0045 backsType = problemDef.contrastBacksType;
0046 calcSLD = controls.calcSld;
0047 
0048 <span class="comment">% Pre-allocation of Memort before calculations</span>
0049 outSsubs = params(1);
0050 backgs = zeros(numberOfContrasts,1);
0051 qshifts = zeros(numberOfContrasts,1);
0052 sfs = zeros(numberOfContrasts,1);
0053 nbas = zeros(numberOfContrasts,1);
0054 nbss = zeros(numberOfContrasts,1);
0055 chis = zeros(numberOfContrasts,1);
0056 resols = zeros(numberOfContrasts,1);
0057 allRoughs = zeros(numberOfContrasts,1);
0058 
0059 <span class="comment">% --- Begin memory allocation ---</span>
0060 reflectivity = cell(numberOfContrasts,1);
0061 <span class="keyword">for</span> i = 1:numberOfContrasts
0062     reflectivity{i} = [1 1 ; 1 1];
0063 <span class="keyword">end</span>
0064 coder.varsize(<span class="string">'reflectivity{:}'</span>,[10000 2],[1 1]);
0065 
0066 Simulation = cell(numberOfContrasts,1);
0067 <span class="keyword">for</span> i = 1:numberOfContrasts
0068     Simulation{i} = [1 1 ; 1 1];
0069 <span class="keyword">end</span>
0070 coder.varsize(<span class="string">'Simulation{:}'</span>,[10000 2],[1 0]);
0071 
0072 
0073 shifted_data = cell(numberOfContrasts,1);
0074 <span class="keyword">for</span> i = 1:numberOfContrasts
0075     shifted_data{i} = [1 1 1; 1 1 1];
0076 <span class="keyword">end</span>
0077 coder.varsize(<span class="string">'shifted_data{:}'</span>,[10000 3],[1 0]);
0078 
0079 layerSlds = cell(numberOfContrasts,1);
0080 <span class="keyword">for</span> i = 1:numberOfContrasts
0081     layerSlds{i} = [1 1 1; 1 1 1];
0082 <span class="keyword">end</span>
0083 coder.varsize(<span class="string">'layerSlds{:}'</span>,[10000 3],[1 0]);
0084 
0085 sldProfiles = cell(numberOfContrasts,1);
0086 <span class="keyword">for</span> i = 1:numberOfContrasts
0087     sldProfiles{i} = [1 1; 1 1];
0088 <span class="keyword">end</span>
0089 coder.varsize(<span class="string">'sldProfiles{:}'</span>,[10000 2],[1 0]);
0090 
0091 allLayers = cell(numberOfContrasts,1);
0092 <span class="keyword">for</span> i = 1:numberOfContrasts
0093     allLayers{i} = [1 ; 1];
0094 <span class="keyword">end</span>
0095 coder.varsize(<span class="string">'allLayers{:}'</span>,[10000 3],[1 1]);
0096 <span class="comment">%    --- End Memory Allocation ---</span>
0097 
0098 parallel = controls.para;
0099 
0100 <span class="keyword">switch</span> parallel
0101     <span class="keyword">case</span> <span class="string">'single'</span>
0102         [outSsubs,backgs,qshifts,sfs,nbas,nbss,resols,chis,<span class="keyword">...</span>
0103             reflectivity,Simulation,shifted_data,layerSlds,<span class="keyword">...</span>
0104             sldProfiles,allLayers,allRoughs] = <span class="keyword">...</span>
0105             <a href="../../../RAT/targetFunctions/standard_TF/standardTF_custLay/standardTF_custlay_single.html" class="code" title="function [outSsubs,backgs,qshifts,sfs,nbas,nbss,resols,chis,reflectivity,Simulation,shifted_data,layerSlds,sldProfiles,allLayers,allRoughs] =standardTF_custlay_single(resample,numberOfContrasts,geometry,repeatLayers,cBacks,cShifts,cScales,cNbas,cNbss,cRes,backs,shifts,sf,nba,nbs,res,dataPresent,allData,dataLimits,simLimits,nParams,params,contrastLayers,numberOfLayers,layersDetails,problemDef_limits,fname,lang,path,backsType,calcSld)">standardTF_custlay_single</a><span class="keyword">...</span>
0106             (resample,numberOfContrasts,geometry,repeatLayers,cBacks, <span class="keyword">...</span>
0107             cShifts,cScales,cNbas,cNbss,cRes,backs,shifts,sf,nba,nbs, <span class="keyword">...</span>
0108             res,dataPresent,allData,dataLimits,simLimits,nParams,params, <span class="keyword">...</span>
0109             contrastLayers,numberOfLayers,layersDetails,problemDef_limits, <span class="keyword">...</span>
0110             fname,lang,path,backsType,calcSLD);
0111         
0112     <span class="keyword">case</span> <span class="string">'points'</span>
0113                 [outSsubs,backgs,qshifts,sfs,nbas,nbss,resols,chis,<span class="keyword">...</span>
0114             reflectivity,Simulation,shifted_data,layerSlds,<span class="keyword">...</span>
0115             sldProfiles,allLayers,allRoughs] = <span class="keyword">...</span>
0116             <a href="../../../RAT/targetFunctions/standard_TF/standardTF_custLay/standardTF_custlay_paraPoints.html" class="code" title="function [outSsubs,backgs,qshifts,sfs,nbas,nbss,resols,chis,reflectivity,Simulation,shifted_data,layerSlds,sldProfiles,allLayers,allRoughs] =standardTF_custlay_paraPoints(resample,numberOfContrasts,geometry,repeatLayers,cBacks,cShifts,cScales,cNbas,cNbss,cRes,backs,shifts,sf,nba,nbs,res,dataPresent,allData,dataLimits,simLimits,nParams,params,contrastLayers,numberOfLayers,layersDetails,problemDef_limits,fname,lang,path,backsType,calcSld)">standardTF_custlay_paraPoints</a><span class="keyword">...</span>
0117             (resample,numberOfContrasts,geometry,repeatLayers,cBacks, <span class="keyword">...</span>
0118             cShifts,cScales,cNbas,cNbss,cRes,backs,shifts,sf,nba,nbs, <span class="keyword">...</span>
0119             res,dataPresent,allData,dataLimits,simLimits,nParams,params, <span class="keyword">...</span>
0120             contrastLayers,numberOfLayers,layersDetails,problemDef_limits, <span class="keyword">...</span>
0121             fname,lang,path,backsType,calcSLD);
0122         
0123      <span class="keyword">case</span> <span class="string">'contrasts'</span>
0124                 [outSsubs,backgs,qshifts,sfs,nbas,nbss,resols,chis,<span class="keyword">...</span>
0125             reflectivity,Simulation,shifted_data,layerSlds,<span class="keyword">...</span>
0126             sldProfiles,allLayers,allRoughs] = <span class="keyword">...</span>
0127             <a href="../../../RAT/targetFunctions/standard_TF/standardTF_custLay/standardTF_custlay_paraContrasts.html" class="code" title="function [outSsubs,backgs,qshifts,sfs,nbas,nbss,resols,chis,reflectivity,Simulation,shifted_data,layerSlds,sldProfiles,allLayers,allRoughs] =standardTF_custlay_single(resample,numberOfContrasts,geometry,repeatLayers,cBacks,cShifts,cScales,cNbas,cNbss,cRes,backs,shifts,sf,nba,nbs,res,dataPresent,allData,dataLimits,simLimits,nParams,params,contrastLayers,numberOfLayers,layersDetails,problemDef_limits,fname,lang,path,backsType,calcSld)">standardTF_custlay_paraContrasts</a><span class="keyword">...</span>
0128             (resample,numberOfContrasts,geometry,repeatLayers,cBacks, <span class="keyword">...</span>
0129             cShifts,cScales,cNbas,cNbss,cRes,backs,shifts,sf,nba,nbs, <span class="keyword">...</span>
0130             res,dataPresent,allData,dataLimits,simLimits,nParams,params, <span class="keyword">...</span>
0131             contrastLayers,numberOfLayers,layersDetails,problemDef_limits, <span class="keyword">...</span>
0132             fname,lang,path,backsType,calcSLD);
0133         
0134 <span class="keyword">end</span>
0135 
0136 problem.ssubs = outSsubs;
0137 problem.backgrounds = backgs;
0138 problem.qshifts = qshifts;
0139 problem.scalefactors = sfs;
0140 problem.nbairs = nbas;
0141 problem.nbsubs = nbss;
0142 problem.resolutions = resols;
0143 problem.calculations.all_chis = chis;
0144 problem.calculations.sum_chi = sum(chis);
0145 problem.allSubRough = allRoughs;
0146 
0147 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Sat 20-Feb-2021 16:50:51 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>