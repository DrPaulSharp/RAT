<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of r1ToProblemDef</title>
  <meta name="keywords" content="r1ToProblemDef">
  <meta name="description" content="--------------------------------------------------------------------------">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- # RAT --><!-- ../../menu.html API --><!-- # old --><!-- menu.html problemDef_class -->
<h1>r1ToProblemDef
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>--------------------------------------------------------------------------</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>function [thisProblemDef,thisControlsDef] = r1ToProblemDef(r1Problem) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">--------------------------------------------------------------------------

               Copies a Rascal 1 project to new
               problemDef class for use in RAT.
               Also makes the controls block

--------------------------------------------------------------------------</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="../../../../RAT/API/controlsDef_class/controlsDef.html" class="code" title="">controlsDef</a>	</li><li><a href="../../../../RAT/API/old/controlsDef_class/controlsDef.html" class="code" title="">controlsDef</a>	</li><li><a href="problemDef.html" class="code" title="">problemDef</a>	</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [thisProblemDef,thisControlsDef] = r1ToProblemDef(r1Problem)</a>
0002 
0003 <span class="comment">%--------------------------------------------------------------------------</span>
0004 <span class="comment">%</span>
0005 <span class="comment">%               Copies a Rascal 1 project to new</span>
0006 <span class="comment">%               problemDef class for use in RAT.</span>
0007 <span class="comment">%               Also makes the controls block</span>
0008 <span class="comment">%</span>
0009 <span class="comment">%--------------------------------------------------------------------------</span>
0010 
0011 
0012 
0013 <span class="comment">%start by making empty default problemDef class.</span>
0014 thisProblemDef = <a href="problemDef.html" class="code" title="">problemDef</a>();
0015 thisControlsDef = <a href="../../../../RAT/API/controlsDef_class/controlsDef.html" class="code" title="">controlsDef</a>();
0016 <span class="comment">%controls = makeControls();</span>
0017 
0018 <span class="comment">%Load in the R1 problem....</span>
0019 r1Problem = load(r1Problem);
0020 problem = r1Problem.problem;
0021 
0022 
0023 numberOfContrasts = length(problem.simLimits);
0024 
0025 thisProblemDef.numberOfContrasts = numberOfContrasts;
0026 thisProblemDef.resample = zeros(1,numberOfContrasts);
0027 oldGeometry = problem.module.experiment_type;
0028 
0029 <span class="keyword">if</span> strcmpi(oldGeometry,<span class="string">'Air / Liquid (or solid)'</span>)
0030     thisProblemDef.experimentGeometry = <span class="string">'air/substrate'</span>;
0031 <span class="keyword">else</span>
0032     thisProblemDef.experimentGeometry = <span class="string">'substrate/liquid'</span>;
0033 <span class="keyword">end</span>
0034 
0035 thisProblemDef.nBackgrounds = length(problem.backs);
0036 thisProblemDef.backgrounds = problem.backs;
0037 thisProblemDef.backgroundNames = problem.backsNames;
0038 <span class="keyword">for</span> n = 1:length(problem.backs)
0039     thisProblemDef.backgroundConstr{n} = problem.backs_constr(n,:);
0040 <span class="keyword">end</span>
0041 
0042 thisProblemDef.nQzshifts = length(problem.shifts_horisontal);
0043 thisProblemDef.qzshifts = problem.shifts_horisontal;
0044 thisProblemDef.qzshiftNames = problem.shiftsNames;
0045 <span class="keyword">for</span> n = 1:length(problem.shifts_horisontal)
0046     thisProblemDef.qzshiftConstr{n} = problem.shifts_constr(n,:);
0047 <span class="keyword">end</span>
0048 
0049 thisProblemDef.nScalefactors = length(problem.scalefac);
0050 thisProblemDef.scalefactors = problem.scalefac;
0051 thisProblemDef.scalefactorNames = problem.scalesNames;
0052 <span class="keyword">for</span> n = 1:length(problem.scalefac)
0053     thisProblemDef.scalefactorConstr{n} = problem.scale_constr(n,:);
0054 <span class="keyword">end</span>
0055 
0056 thisProblemDef.nNbairs = length(problem.nba);
0057 thisProblemDef.nbairs = problem.nba;
0058 thisProblemDef.nbairNames = problem.nbaNames;
0059 <span class="keyword">for</span> n = 1:length(problem.nba)
0060     thisProblemDef.nbairConstr{n} = problem.nbairs_constr(n,:);
0061 <span class="keyword">end</span>
0062 
0063 thisProblemDef.nNbsubs = length(problem.nbs);
0064 thisProblemDef.nbsubs = problem.nbs;
0065 thisProblemDef.nbsubNames = problem.nbsNames;
0066 <span class="keyword">for</span> n = 1:length(problem.nbs)
0067     thisProblemDef.nbsubConstr{n} = problem.nbsubs_constr(n,:);
0068 <span class="keyword">end</span>
0069 
0070 thisProblemDef.nResolutions = length(problem.resolution);
0071 thisProblemDef.resolutions = problem.resolution;
0072 thisProblemDef.resolutionNames = problem.resolNames;
0073 <span class="keyword">for</span> n = 1:length(problem.resolution)
0074     thisProblemDef.resolutionConstr{n} = problem.resolution_constr(n,:);
0075 <span class="keyword">end</span>
0076 
0077 
0078 thisProblemDef.dataPresent = problem.dataPresent;
0079 thisProblemDef.allData = problem.data;
0080 thisProblemDef.dataLimits = problem.dataLimits;
0081 thisProblemDef.simLimits = problem.simLimits;
0082 <span class="keyword">for</span> i = 1:length(problem.repeatLayers)
0083     thisProblemDef.contrastRepeatSLDs{i} = problem.repeatLayers{i};
0084 <span class="keyword">end</span>
0085 thisProblemDef.nParams = length(problem.params);
0086 thisProblemDef.params = problem.params;
0087 thisProblemDef.paramNames = problem.paramnames;
0088 thisProblemDef.contrastLayers = problem.contrastLayers;
0089 thisProblemDef.numberOfLayers = problem.numberOfLayers;
0090 <span class="comment">%problemDef.layersDetails = problem.layersDetails;</span>
0091 <span class="comment">%thisProblemDef.whichType = []; %Er.... what's this???</span>
0092 <span class="comment">% thisProblemDef.modelFilename = '';</span>
0093 <span class="comment">% thisProblemDef.modelLanguage = 'matlab';</span>
0094 
0095 <span class="comment">%Use the new method for backgrounds</span>
0096 theseCBacks = problem.contrastBacks;
0097 newCbacks = cell(1,length(theseCBacks));
0098 <span class="keyword">for</span> i = 1:length(theseCBacks)
0099     newCbacks{i} = [theseCBacks(i) 1];
0100 <span class="keyword">end</span>
0101 thisProblemDef.contrastBacks = newCbacks;
0102 thisProblemDef.contrastShifts = problem.contrastShifts;
0103 thisProblemDef.contrastScales = problem.contrastScales;
0104 thisProblemDef.contrastNbas = problem.contrastNbas;
0105 thisProblemDef.contrastNbss = problem.contrastNbss;
0106 thisProblemDef.contrastRes = problem.contrastResolutions;
0107 
0108 <span class="keyword">if</span> strcmpi(problem.module.type,<span class="string">'standard layers'</span>)
0109     
0110     thisProblemDef.modelType = <span class="string">'layers'</span>;
0111     
0112     <span class="comment">%Some extra work to be done with layers</span>
0113     <span class="comment">%details because they are a different format.</span>
0114     <span class="keyword">for</span> i = 1:length(problem.layersDetails)
0115         thisLayer = problem.layersDetails{i};
0116         newLayer(1) = str2double(thisLayer{1});
0117         newLayer(2) = str2double(thisLayer{2});
0118         newLayer(3) = str2double(thisLayer{3});
0119         <span class="keyword">if</span> isempty(thisLayer{4})
0120             newLayer(4) = NaN;
0121         <span class="keyword">else</span>
0122             newLayer(4) = str2double(thisLayer{4});
0123         <span class="keyword">end</span>
0124         
0125         <span class="keyword">if</span> strcmpi(thisLayer{6},<span class="string">'bulk in'</span>)
0126             newLayer(5) = 2;
0127         <span class="keyword">else</span>
0128             newLayer(5) = 1;
0129         <span class="keyword">end</span>
0130         
0131         thisProblemDef.layersDetails{i} = newLayer;
0132     <span class="keyword">end</span>
0133     
0134     <span class="comment">%Also each contratLayers needs to change from 'cell'</span>
0135     <span class="comment">%to double, stripping out the commas.</span>
0136     <span class="keyword">for</span> i = 1:length(problem.contrastLayers)
0137         thisContrastLayer = problem.contrastLayers{i};
0138         newContrastLayer = [];
0139         <span class="keyword">for</span> n = 1:length(thisContrastLayer)
0140             <span class="keyword">if</span> ~strcmpi(thisContrastLayer(n),<span class="string">','</span>)
0141                 newContrastLayer(length(newContrastLayer)+1) = str2double(thisContrastLayer(n));
0142             <span class="keyword">end</span>
0143         <span class="keyword">end</span>
0144         thisProblemDef.contrastLayers{i} = newContrastLayer;
0145     <span class="keyword">end</span>
0146     
0147 <span class="keyword">elseif</span> strcmpi(problem.module.type,<span class="string">'Custom Layers'</span>)
0148     thisProblemDef.modelType = <span class="string">'Custom Layers'</span>;
0149     fname = problem.module.name;
0150     thisProblemDef.modelFilename = fname;
0151     thisProblemDef.modelLanguage = <span class="string">'matlab'</span>; <span class="comment">%Rascal1 has no python scripting option</span>
0152     
0153     
0154 <span class="keyword">elseif</span> strcmpi(problem.module.type,<span class="string">'Custom XY Profile'</span>)
0155     thisProblemDef.modelType = <span class="string">'Custom XY'</span>;
0156     fname = problem.module.name;
0157     thisProblemDef.modelFilename = fname;
0158     thisProblemDef.modelLanguage = <span class="string">'matlab'</span>; <span class="comment">%Rascal1 has no python scripting option</span>
0159 <span class="keyword">end</span>
0160 
0161 <span class="comment">%Limits</span>
0162 <span class="keyword">for</span> i = 1:size(problem.constr,1)
0163     thisProblemDef.paramConstr{i} = problem.constr(i,:);
0164 <span class="keyword">end</span>
0165 
0166 <span class="keyword">for</span> i = 1:size(problem.backs_constr,1)
0167     thisProblemDef.backgroundConstr{i} = problem.backs_constr(i,:);
0168 <span class="keyword">end</span>
0169 
0170 <span class="keyword">for</span> i = 1:size(problem.scale_constr,1)
0171     thisProblemDef.scalefactorConstr{i} = problem.scale_constr(i,:);
0172 <span class="keyword">end</span>
0173 
0174 <span class="keyword">for</span> i = 1:size(problem.shifts_constr,1)
0175     thisProblemDef.qzshiftConstr{i} = problem.shifts_constr(i,:);
0176 <span class="keyword">end</span>
0177 
0178 <span class="keyword">for</span> i = 1:size(problem.nbairs_constr,1)
0179     thisProblemDef.nbairConstr{i} = problem.nbairs_constr(i,:);
0180 <span class="keyword">end</span>
0181 
0182 <span class="keyword">for</span> i = 1:size(problem.nbsubs_constr,1)
0183     thisProblemDef.nbsubConstr{i} = problem.nbsubs_constr(i,:);
0184 <span class="keyword">end</span>
0185 
0186 <span class="keyword">for</span> i = 1:size(problem.resolution_constr,1)
0187     thisProblemDef.resolutionConstr{i} = problem.resolution_constr(i,:);
0188 <span class="keyword">end</span>
0189 
0190 thisProblemDef.paramFitYesNo = problem.fityesno;
0191 thisProblemDef.backgroundFitYesNo = problem.backgrounds_fityesno;
0192 thisProblemDef.qzshiftFitYesNo = problem.shifts_fityesno;
0193 thisProblemDef.scalefactorFitYesNo = problem.scalefac_fityesno;
0194 thisProblemDef.nbairFitYesNo = problem.nbairs_fityesno;
0195 thisProblemDef.nbsubFitYesNo = problem.nbsubs_fityesno;
0196 thisProblemDef.resolutionFitYesNo = problem.resolution_fityesno;
0197 
0198 
0199 
0200 <span class="comment">% controls.TF = 'standardTF';</span>
0201 <span class="comment">% controls.Para = 'single';</span>
0202 <span class="comment">% controls.proc = 'calculate';</span>
0203 <span class="comment">% controls.tfType = 'stanLay';</span>
0204 <span class="comment">% controls.lang = 'matlab';</span>
0205 <span class="comment">%</span>
0206 <span class="comment">% controls.algArgs.maxInter = Inf;</span>
0207 <span class="comment">% controls.algArgs.tolFun = 1.0000e-06;</span>
0208 <span class="comment">% controls.algArgs.tolX = 1.0000e-06;</span>
0209 <span class="comment">% controls.algArgs.maxFunEvals = Inf;</span>
0210 <span class="comment">%</span>
0211 
0212 
0213 <span class="keyword">end</span>
0214 
0215 
0216 
0217 
0218 
0219 
0220 
0221</pre></div>
<hr><address>Generated on Sun 18-Apr-2021 20:40:23 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>