<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of boxoex</title>
  <meta name="keywords" content="boxoex">
  <meta name="description" content="%">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../../menu.html minimisers --><!-- ../menu.html mcmcstat --><!-- menu.html examples -->
<h1>boxoex
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>%</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">%
 &lt;html&gt;&lt;a href=&quot;../index.html&quot;&gt;MCMC toolbox&lt;/a&gt; » &lt;a href=&quot;../examples.html&quot;&gt;Examples&lt;/a&gt; » Boxo&lt;/html&gt;</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../minimisers/mcmcstat/datamerge.html" class="code" title="function xy = datamerge(x,y,intinds)">datamerge</a>	DATAMERGE Merge matrises by first columns</li><li><a href="boxoM.html" class="code" title="function ymod=boxoM(data,theta)">boxoM</a>	model function for the boxo example</li><li><a href="boxoODE.html" class="code" title="function dy = boxoODE(t,y,theta)">boxoODE</a>	ode function for the boxo example</li><li><a href="../../../minimisers/mcmcstat/mcmcplot.html" class="code" title="function mcmcplot(chain,inds,names,plottype,varargin)">mcmcplot</a>	MCMCPLOT Plot mcmc chain</li><li><a href="../../../minimisers/mcmcstat/mcmcpred.html" class="code" title="function out=mcmcpred(results,chain,s2chain,data,problem,modelfun,nsample,varargin)">mcmcpred</a>	MCMCPRED predictive calculations from the mcmcrun chain</li><li><a href="../../../minimisers/mcmcstat/mcmcpredplot.html" class="code" title="function h=mcmcpredplot(out,data,adddata)">mcmcpredplot</a>	MCMCPREDPLOT - predictive plot for mcmc results</li><li><a href="../../../minimisers/mcmcstat/mcmcrun.html" class="code" title="function [results,chain,s2chain,sschain, hchain]=mcmcrun(model,data,problem,params,options,res)">mcmcrun</a>	MCMCRUN Metropolis-Hastings MCMC simulation for nonlinear Gaussian models</li><li><a href="../../../minimisers/mcmcstat_new/datamerge.html" class="code" title="function xy = datamerge(x,y,intinds)">datamerge</a>	DATAMERGE Merge matrises by first columns</li><li><a href="../../../minimisers/mcmcstat_new/mcmcplot.html" class="code" title="function mcmcplot(chain,inds,names,plottype,varargin)">mcmcplot</a>	MCMCPLOT Plot mcmc chain</li><li><a href="../../../minimisers/mcmcstat_new/mcmcpred.html" class="code" title="function out=mcmcpred(results,chain,s2chain,data,problem,modelfun,nsample,varargin)">mcmcpred</a>	MCMCPRED predictive calculations from the mcmcrun chain</li><li><a href="../../../minimisers/mcmcstat_new/mcmcpredplot.html" class="code" title="function h=mcmcpredplot(out,data,adddata)">mcmcpredplot</a>	MCMCPREDPLOT - predictive plot for mcmc results</li><li><a href="../../../minimisers/mcmcstat_new/mcmcrun.html" class="code" title="function [results,chain,s2chain,sschain, hchain]=mcmcrun(model,data,params,options,res)">mcmcrun</a>	MCMCRUN Metropolis-Hastings MCMC simulation for nonlinear Gaussian models</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%%</span>
0002 <span class="comment">% &lt;html&gt;&lt;a href=&quot;../index.html&quot;&gt;MCMC toolbox&lt;/a&gt; » &lt;a href=&quot;../examples.html&quot;&gt;Examples&lt;/a&gt; » Boxo&lt;/html&gt;</span>
0003 
0004 <span class="comment">%% Boxo chemical kinetics example.</span>
0005 <span class="comment">% Chemical kinetics example. We model reactions _A_ -&gt; _B_ -&gt; _C_, with</span>
0006 <span class="comment">% Arrhenius temperature dependence in the reaction rates. Model is an</span>
0007 <span class="comment">% ode system. See &lt;boxoM.html |boxoM.m|&gt; for the model function and</span>
0008 <span class="comment">% &lt;boxoODE.html |boxoODE.m|&gt; for the ode system function.</span>
0009 <span class="comment">%</span>
0010 <span class="comment">% Model unknowns are reaction rate parameters _k1_ and _k2_,</span>
0011 <span class="comment">% activation energies _E1_ and _E2_ and the initial concentrations of</span>
0012 <span class="comment">% _A_ in both the batches (total of 6 unknowns).</span>
0013 
0014 <span class="comment">% This will take some time if |boxoM| does not use |lsode_mex|.</span>
0015 
0016 clear model data params options
0017 
0018 <span class="comment">%%</span>
0019 <span class="comment">% Set some parameters for the run.</span>
0020 method      = <span class="string">'dram'</span>; <span class="comment">% adaptation method, 'mh', 'dr', 'am', or 'dram'</span>
0021 nsimu       = 5000;   <span class="comment">% number of simulations</span>
0022 adaptint    = 500;    <span class="comment">% how often to adapt the proposal</span>
0023 
0024 <span class="comment">%% Data</span>
0025 <span class="comment">% We have two data sets (=batches).</span>
0026 data{1}.ydata = [
0027 <span class="comment">%  time    A      B</span>
0028    0   1.000   0.000
0029    1   0.504   0.416
0030    2   0.186   0.489
0031    3   0.218   0.595
0032    4   0.022   0.506
0033    5   0.102   0.493
0034    6   0.058   0.458
0035    7   0.064   0.394
0036    8   0.000   0.335
0037    9   0.082   0.309
0038 ];
0039 data{2}.ydata = [
0040 <span class="comment">%  time    A       B</span>
0041    0   1.000   0.000
0042    1   0.415   0.518
0043    2   0.156   0.613
0044    3   0.196   0.644
0045    4   0.055   0.444
0046    5   0.011   0.435
0047    6   0.000   0.323
0048    7   0.032   0.390
0049    8   0.000   0.149
0050    9   0.079   0.222
0051 ];
0052 
0053 <span class="comment">%% Model parameters</span>
0054 <span class="comment">% The initial values for _A_ and _B_ and the (fixed) temperatures are</span>
0055 <span class="comment">% local to the batches. Initial value for _A_ has some error in it,</span>
0056 <span class="comment">% but _B_ is assumed to be exactly 0.</span>
0057 params = {
0058 <span class="comment">%      name,  init,        min, max, mu,  sig, target?, local?</span>
0059     {<span class="string">'k1mean'</span>, 1.0,        0,  Inf,  NaN, Inf,   1,      0}
0060     {<span class="string">'E1'</span>    , 0.01,       0,  Inf,  NaN, Inf,   1,      0}
0061     {<span class="string">'k2mean'</span>, 1.0,        0,  Inf,  NaN, Inf,   1,      0}
0062     {<span class="string">'E2'</span>,     0.01,       0,  Inf,  NaN, Inf,   1,      0}
0063     {<span class="string">'Tmean'</span>,  300,      -Inf, Inf,  NaN, Inf,   0,      0}
0064     {<span class="string">'Temp'</span> ,  [283 313],  0,  0,    NaN, Inf,   0,      1}
0065     {<span class="string">'A0'</span>,     [1.0 1.0],  0,  Inf,  1,   0.1,   1,      1}
0066     {<span class="string">'B0'</span>,     [0.0 0.0],  0,  Inf,  NaN, Inf,   0,      1}
0067          };
0068 
0069 <span class="comment">%% Model options</span>
0070 <span class="comment">%</span>
0071 
0072 <span class="comment">% model.ssfun     = @boxoSS;</span>
0073 model.modelfun   = @<a href="boxoM.html" class="code" title="function ymod=boxoM(data,theta)">boxoM</a>; <span class="comment">% use mcmcrun generated ssfun instead</span>
0074 model.sigma2     = 0.01;   <span class="comment">% initial error variance</span>
0075 model.N0         = 4;      <span class="comment">% prior (invchisq) weight for sigma2</span>
0076 
0077 options.method      = method;        <span class="comment">% adaptation method (mh,am,dr,dram)</span>
0078 options.nsimu       = nsimu;         <span class="comment">% n:o of simulations</span>
0079 options.qcov        = eye(11)*0.001; <span class="comment">% proposal covariance</span>
0080 options.adaptint    = adaptint; <span class="comment">% adaptation interval</span>
0081 options.printint    = 200; <span class="comment">% how often to show info on acceptance ratios</span>
0082 options.verbosity   = 1;  <span class="comment">% how much to show output in Matlab window</span>
0083 options.waitbar     = 1;  <span class="comment">% show garphical waitbar</span>
0084 options.updatesigma = 1;  <span class="comment">% update error variance</span>
0085 options.stats       = 1;  <span class="comment">% save extra statistics in results</span>
0086 
0087 <span class="comment">%% MCMC run</span>
0088 <span class="comment">% As we start from non optimized values the chain will need some</span>
0089 <span class="comment">% time to find the location of the posterior.</span>
0090 <span class="comment">% We do 3 runs, starting from the values of the previous run.</span>
0091 results = [];
0092 [results,chain,s2chain,sschain]=<a href="../../../minimisers/mcmcstat/mcmcrun.html" class="code" title="function [results,chain,s2chain,sschain, hchain]=mcmcrun(model,data,problem,params,options,res)">mcmcrun</a>(model,data,params,options,results);
0093 [results,chain,s2chain,sschain]=<a href="../../../minimisers/mcmcstat/mcmcrun.html" class="code" title="function [results,chain,s2chain,sschain, hchain]=mcmcrun(model,data,problem,params,options,res)">mcmcrun</a>(model,data,params,options,results);
0094 [results,chain,s2chain,sschain]=<a href="../../../minimisers/mcmcstat/mcmcrun.html" class="code" title="function [results,chain,s2chain,sschain, hchain]=mcmcrun(model,data,problem,params,options,res)">mcmcrun</a>(model,data,params,options,results);
0095 
0096 
0097 <span class="comment">%% Chain plots</span>
0098 <span class="comment">%</span>
0099 figure(1); clf
0100 <a href="../../../minimisers/mcmcstat/mcmcplot.html" class="code" title="function mcmcplot(chain,inds,names,plottype,varargin)">mcmcplot</a>(chain,[],results,<span class="string">'chainpanel'</span>);
0101 figure(2); clf
0102 <a href="../../../minimisers/mcmcstat/mcmcplot.html" class="code" title="function mcmcplot(chain,inds,names,plottype,varargin)">mcmcplot</a>(chain,[],results,<span class="string">'pairs'</span>);
0103 
0104 <span class="comment">%% Plot of the data and the mean posterior fit</span>
0105 <span class="comment">%</span>
0106 mcmean = mean(chain); <span class="comment">% posterior mean parameter vector</span>
0107 figure(3); clf
0108 <span class="keyword">for</span> i=1:results.nbatch
0109   subplot(2,1,i)
0110   plot(data{i}.ydata(:,1),data{i}.ydata(:,2:3),<span class="string">'o'</span>);
0111   t = linspace(0,10); <span class="comment">% time for plots</span>
0112   th = results.theta; <span class="comment">% the whole parameter vector, including not sampled</span>
0113   th(results.parind) = mcmean; <span class="comment">% set sampled components</span>
0114   thi = th(results.local==0|results.local==i); <span class="comment">% local parameters</span>
0115   [t,y] = ode45(@<a href="boxoODE.html" class="code" title="function dy = boxoODE(t,y,theta)">boxoODE</a>,t,thi(end-1:end),[],thi);
0116   hold on; plot(t,y); hold off
0117   title(sprintf(<span class="string">'batch %d'</span>,i));
0118 <span class="keyword">end</span>
0119 
0120 <span class="comment">%% Preditive plots</span>
0121 <span class="comment">% We need to augment the time in ydata to get more plot points</span>
0122 <span class="comment">% |datamerge| in the toolbox does this.</span>
0123 time = linspace(0,9,50)'; <span class="comment">% new time vector</span>
0124 data{1}.ydata = <a href="../../../minimisers/mcmcstat/datamerge.html" class="code" title="function xy = datamerge(x,y,intinds)">datamerge</a>(data{1}.ydata,time);
0125 data{2}.ydata = <a href="../../../minimisers/mcmcstat/datamerge.html" class="code" title="function xy = datamerge(x,y,intinds)">datamerge</a>(data{2}.ydata,time);
0126 
0127 <span class="comment">%%</span>
0128 <span class="comment">% Function |mcmcpred| calculates the predictive plots, and</span>
0129 <span class="comment">% |mcmcpredplot| does the plot.</span>
0130 out = <a href="../../../minimisers/mcmcstat/mcmcpred.html" class="code" title="function out=mcmcpred(results,chain,s2chain,data,problem,modelfun,nsample,varargin)">mcmcpred</a>(results,chain,[],data,@<a href="boxoM.html" class="code" title="function ymod=boxoM(data,theta)">boxoM</a>,500);
0131 h = <a href="../../../minimisers/mcmcstat/mcmcpredplot.html" class="code" title="function h=mcmcpredplot(out,data,adddata)">mcmcpredplot</a>(out,data,1);
0132</pre></div>
<hr><address>Generated on Wed 28-Jul-2021 14:15:23 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>