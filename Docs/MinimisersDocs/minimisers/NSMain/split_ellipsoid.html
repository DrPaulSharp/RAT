<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of split_ellipsoid</title>
  <meta name="keywords" content="split_ellipsoid">
  <meta name="description" content="function [u1, u2, VE1, VE2, nosplit] = split_ellipsiod(u, VS)">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../menu.html minimisers --><!-- menu.html NSMain -->
<h1>split_ellipsoid
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function [u1, u2, VE1, VE2, nosplit] = split_ellipsiod(u, VS)</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function [u1, u2, VE1, VE2, nosplit] = split_ellipsoid(u, VS) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> function [u1, u2, VE1, VE2, nosplit] = split_ellipsiod(u, VS)

 This function takes in a set of multi-dimensional data points u and the
 sample volume (VS) that they occupy. It uses the k-means algorthim to
 split the points into two sub-clusters and uses an optimisation scheme to
 re-assign points, if necessary, between the sub-clusters. This is based
 on the description in Algorithm 1 of the MULTINEST paper by Feroz,
 Hobson, and Bridges, MNRAS, 398, 1601-1614 (2009).

 The function returns the points in the two sub-cluster u1 and u2, and 
 the volumes of the ellipsoid subclusters VE1 and VE2.  The flag nosplit 
 is set to 1 if the splitting cannot be done; otherwise = 0.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="calc_ellipsoid.html" class="code" title="function [B, mu, VE, flag] = calc_ellipsoid(u, VS)">calc_ellipsoid</a>	</li><li><a href="kmeans.html" class="code" title="function [idx, C, sumD, D] = kmeans(X, k, varargin)">kmeans</a>	KMEANS K-means clustering.</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="optimal_ellipsoids.html" class="code" title="function [Bs, mus, VEs, ns] = optimal_ellipsoids(u, VS)">optimal_ellipsoids</a>	function [Bs, mus, VEs, ns] = optimal_ellipsoids(u, VS)</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [u1, u2, VE1, VE2, nosplit] = split_ellipsoid(u, VS)</a>
0002 
0003 <span class="comment">% function [u1, u2, VE1, VE2, nosplit] = split_ellipsiod(u, VS)</span>
0004 <span class="comment">%</span>
0005 <span class="comment">% This function takes in a set of multi-dimensional data points u and the</span>
0006 <span class="comment">% sample volume (VS) that they occupy. It uses the k-means algorthim to</span>
0007 <span class="comment">% split the points into two sub-clusters and uses an optimisation scheme to</span>
0008 <span class="comment">% re-assign points, if necessary, between the sub-clusters. This is based</span>
0009 <span class="comment">% on the description in Algorithm 1 of the MULTINEST paper by Feroz,</span>
0010 <span class="comment">% Hobson, and Bridges, MNRAS, 398, 1601-1614 (2009).</span>
0011 <span class="comment">%</span>
0012 <span class="comment">% The function returns the points in the two sub-cluster u1 and u2, and</span>
0013 <span class="comment">% the volumes of the ellipsoid subclusters VE1 and VE2.  The flag nosplit</span>
0014 <span class="comment">% is set to 1 if the splitting cannot be done; otherwise = 0.</span>
0015 <span class="comment">%</span>
0016 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0017 <span class="keyword">global</span> DEBUG
0018 max_attempt = 50; <span class="comment">% maximum number of attempts to recluster points</span>
0019 
0020 <span class="comment">% default return values</span>
0021 nosplit = 0;
0022 VE1 = [];
0023 VE2 = [];
0024 u1 = [];
0025 u2 = [];
0026 
0027 <span class="comment">% extract number of samples and number of dimensions</span>
0028 N = size(u,1); 
0029 D = size(u,2); 
0030 
0031 <span class="comment">% check total number of samples</span>
0032 <span class="keyword">if</span> N &lt; 2*(D+1)
0033     <span class="keyword">if</span> DEBUG; fprintf(<span class="string">'CANT SPLIT: total number of samples is too small!  N = %d\n'</span>, N); <span class="keyword">end</span>;
0034     nosplit = 1;
0035     <span class="keyword">return</span>;
0036 <span class="keyword">end</span>
0037 
0038 <span class="comment">% use kmeans to separate the data points into two sub-clusters</span>
0039 [idx, mu] = <a href="kmeans.html" class="code" title="function [idx, C, sumD, D] = kmeans(X, k, varargin)">kmeans</a>(u,2);
0040 u1 = u(idx==1,:);
0041 u2 = u(idx==2,:);
0042 
0043 n1 = size(u1,1); <span class="comment">% number of samples in S1</span>
0044 n2 = size(u2,1); <span class="comment">% number of samples in S2</span>
0045 
0046 <span class="comment">% check number of points in subclusters</span>
0047 <span class="keyword">if</span> n1 &lt; D+1 || n2 &lt; D+1
0048     <span class="keyword">if</span> DEBUG; fprintf(<span class="string">'CANT SPLIT: number of samples in subclusters is too small! n1 = %d, n2 = %d\n'</span>, n1, n2); <span class="keyword">end</span>;
0049     nosplit = 1;
0050     <span class="keyword">return</span>;
0051 <span class="keyword">end</span>
0052 
0053 <span class="comment">% preallocate temp arrays</span>
0054 temp_u1 = cell(max_attempt,1);
0055 temp_u2 = cell(max_attempt,1);
0056 temp_VE1 = zeros(max_attempt,1);
0057 temp_VE2 = zeros(max_attempt,1);
0058 FS = zeros(max_attempt,1);
0059 
0060 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0061 numreassigned = [];
0062 counter = 1;
0063 <span class="keyword">while</span> 1
0064     
0065     <span class="comment">% calculate minimum volume of ellipsoids</span>
0066     VS1 = VS*n1/N;
0067     VS2 = VS*n2/N;
0068 
0069     <span class="comment">% calculate properties of bounding ellipsoids for the two subclusters</span>
0070     [B1, mu1, VE1, flag1] = <a href="calc_ellipsoid.html" class="code" title="function [B, mu, VE, flag] = calc_ellipsoid(u, VS)">calc_ellipsoid</a>(u1, VS1);
0071     [B2, mu2, VE2, flag2] = <a href="calc_ellipsoid.html" class="code" title="function [B, mu, VE, flag] = calc_ellipsoid(u, VS)">calc_ellipsoid</a>(u2, VS2);
0072     
0073     <span class="comment">% check flags</span>
0074     <span class="keyword">if</span> flag1 || flag2
0075         <span class="keyword">if</span> DEBUG; fprintf(<span class="string">'CANT SPLIT!!\n'</span>); <span class="keyword">end</span>;
0076         nosplit = 1;
0077         <span class="keyword">break</span>
0078     <span class="keyword">end</span>
0079 
0080     <span class="comment">% construct temporary arrays and cell arrays containing results for</span>
0081     <span class="comment">% each pass through the loop</span>
0082     temp_u1{counter} = u1;
0083     temp_u2{counter} = u2;
0084     temp_VE1(counter) = VE1;
0085     temp_VE2(counter) = VE2;
0086     FS(counter)=(VE1+VE2)/VS;
0087 
0088     <span class="comment">% DEBUG print statement</span>
0089     <span class="keyword">if</span> DEBUG
0090         fprintf(<span class="string">'SPLIT ELLIPSOID: counter = %d, FS = %f, numreassigned = %d\n'</span>, <span class="keyword">...</span>
0091                 counter, (VE1+VE2)/VS, numreassigned);
0092     <span class="keyword">end</span>
0093 
0094     <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0095     <span class="comment">% check if points need to be reassigned to the other subcluster</span>
0096     reassign = 0;
0097     
0098     m1 = 0;
0099     m2 = 0;
0100     u1new = zeros(N,D);
0101     u2new = zeros(N,D);
0102 
0103     <span class="comment">% for all points get the Mahalanobis distance between each point and</span>
0104     <span class="comment">% the centroid of each ellipse and assign accordingly</span>
0105     numreassigned = 0;
0106     <span class="keyword">for</span> i=1:N
0107         <span class="comment">% get d = (u-mu)^T * B^-1 * (u-mu)</span>
0108         du1 = ( (u(i,:)-mu1) / B1 ) * (u(i,:)-mu1)';
0109         du2 = ( (u(i,:)-mu2) / B2 ) * (u(i,:)-mu2)';
0110         
0111         <span class="comment">% calculate hk = VEk * duk / VSk;</span>
0112         h1 = VE1 * du1 / VS1;
0113         h2 = VE2 * du2 / VS2;
0114 
0115         <span class="keyword">if</span> h1 &lt; h2
0116             m1 = m1 + 1;
0117             u1new(m1, :) = u(i,:);
0118             
0119             <span class="comment">% check if point has been reassigned or not</span>
0120             <span class="keyword">if</span> idx(i) ~= 1
0121                 reassign = 1;
0122                 idx(i) = 1;
0123                 numreassigned = numreassigned +1;
0124             <span class="keyword">end</span>
0125         <span class="keyword">else</span>
0126             m2 = m2 + 1;
0127             u2new(m2, :) = u(i,:);
0128             
0129             <span class="comment">% check if point has been reassigned or not</span>
0130             <span class="keyword">if</span> idx(i) ~= 2
0131                 reassign = 1;
0132                 idx(i) = 2;
0133                 numreassigned = numreassigned +1;
0134             <span class="keyword">end</span>
0135 
0136         <span class="keyword">end</span>
0137         
0138     <span class="keyword">end</span>
0139 
0140     u1 = []; u2 = []; mu1 = []; mu2 = [];;
0141     n1 = m1;
0142     n2 = m2;
0143     
0144     u1 = u1new(1:n1,:);
0145     u2 = u2new(1:n2,:);
0146 
0147     u1new = []; u2new = [];;
0148 
0149     <span class="comment">% update counter</span>
0150     counter = counter + 1;
0151 
0152     <span class="keyword">if</span> reassign &amp;&amp; counter &lt;= max_attempt
0153         <span class="keyword">continue</span>
0154     <span class="keyword">else</span>
0155         <span class="comment">% DEBUG print statement</span>
0156         <span class="keyword">if</span> DEBUG 
0157             fprintf(<span class="string">'SPLIT ELLIPSOID: counter = %d, FS = %f, numreassigned = %d\n'</span>, counter, (VE1+VE2)/VS, numreassigned);
0158             <span class="keyword">if</span> counter &gt; max_attempt
0159                 fprintf(<span class="string">'SPLIT ELLIPSOID: exceeded maximum attempts; take min F(S).\n'</span>);
0160             <span class="keyword">end</span>
0161         <span class="keyword">end</span>
0162 
0163         <span class="keyword">break</span>
0164     <span class="keyword">end</span>
0165 
0166 <span class="keyword">end</span>
0167 
0168 <span class="comment">% find minimum F(S) and return</span>
0169 [minFS, idx] = min(FS);
0170 u1 = temp_u1{idx};
0171 u2 = temp_u2{idx};
0172 VE1 = temp_VE1(idx);
0173 VE2 = temp_VE2(idx);
0174 
0175 <span class="keyword">if</span> DEBUG; fprintf(<span class="string">'SPLIT ELLIPSOID: min F(S) = %f\n'</span>, minFS); <span class="keyword">end</span>;
0176 
0177 <span class="keyword">return</span>
0178</pre></div>
<hr><address>Generated on Wed 28-Jul-2021 14:15:23 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>