<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of parseBayesResults</title>
  <meta name="keywords" content="parseBayesResults">
  <meta name="description" content="">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../menu.html minimisers --><!-- menu.html NSMain -->
<h1>parseBayesResults
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong></strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function results = parseBayesResults(chain,problemDef,problemDef_cells,problemDef_limits,controls) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="iterShortest.html" class="code" title="function pars = iterShortest(chain,numberOfParams,values)">iterShortest</a>	Now try to work out the shortest 95% confidence interval..</li><li><a href="../../minimisers/generalUtils/bayesStats/iterShortest.html" class="code" title="function vals = iterShortest(chain,numberOfParams,values,predInt)">iterShortest</a>	</li><li><a href="../../minimisers/generalUtils/unpackparams.html" class="code" title="function problemDef = unpackparams(problemDef,controls)">unpackparams</a>	Unpack the params out of the fitparsma and otherparams arrays</li><li><a href="../../minimisers/mcmcstat/range.html" class="code" title="function y=range(x)">range</a>	Y=RANGE(X) range of columns of X</li><li><a href="../../minimisers/mcmcstat_new/range.html" class="code" title="function y=range(x)">range</a>	Y=RANGE(X) range of columns of X</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function results = parseBayesResults(chain,problemDef,problemDef_cells,problemDef_limits,controls)</a>
0002 debug = 1;
0003 
0004 numPars = size(chain,2)-1;
0005 values = zeros(numPars,3);
0006 outChain = chain;
0007 
0008 <span class="comment">%Work out the 95% confidence intervals from the cdfs'</span>
0009 <span class="keyword">for</span> par = 1:numPars
0010    
0011     postvals = chain(:,par);
0012 
0013     <span class="comment">% histogram the data to get the distribution</span>
0014     [n, bins] = hist(postvals, 25);<span class="comment">%length(postvals));</span>
0015     maxn = round(mean(find(n==max(n))));
0016     
0017     
0018     <span class="keyword">switch</span> debug
0019         <span class="keyword">case</span> 1
0020             figure(1);clf;
0021             hist(postvals,30);
0022             drawnow
0023     <span class="keyword">end</span>
0024     
0025     <span class="comment">% get the cumulative probability distribution as normalise it</span>
0026     cs = cumsum(n)/length(postvals);
0027 
0028     <span class="comment">% the probability covered by Nsigma (or you could just set</span>
0029     <span class="comment">% e.g. probarea = 0.95, which is close to the 2sigma value)</span>
0030     Nsigma = 1.5;
0031     probarea = erf(Nsigma/sqrt(2));
0032 
0033     <span class="comment">% get unique values of the cdf (otherwise the interpolation function</span>
0034     <span class="comment">% complains)</span>
0035     [csu, iu, ju] = unique(cs);
0036 
0037     <span class="comment">% get lower bound on the interval</span>
0038     values(par,2) = interp1(csu, bins(iu), 0.5-(probarea/2));
0039 
0040     <span class="comment">% get upper bound on the interval</span>
0041     values(par,3) = interp1(csu, bins(iu), 0.5+(probarea/2));
0042     
0043     <span class="comment">%get best value</span>
0044     <span class="comment">%values(par,1) = mean(max(postvals));</span>
0045     values(par,1) = bins(maxn);
0046     <span class="comment">%disp(values(par,1));</span>
0047 
0048 <span class="keyword">end</span>
0049 
0050 <span class="comment">%Test of iterative shortest intervals....</span>
0051 disp(<span class="string">'Calculating confidence intervals...'</span>);
0052 disp(<span class="string">'iter debug'</span>);
0053 iterRanges = <a href="iterShortest.html" class="code" title="function pars = iterShortest(chain,numberOfParams,values)">iterShortest</a>(chain,numPars,values);
0054 
0055 <span class="comment">%Remove any chains which have values outside the 95% confidence interval</span>
0056 
0057 <span class="comment">% % for CDF's</span>
0058 <span class="comment">% for i = 1:numPars</span>
0059 <span class="comment">%    outOfRange = chain(:,i) &lt; values(i,2) | chain(:,i) &gt; values(i,3);</span>
0060 <span class="comment">%    chain(outOfRange,:) = [];</span>
0061 <span class="comment">% end</span>
0062 
0063 <span class="comment">%for iterative</span>
0064 <span class="keyword">for</span> i = 1:numPars
0065    outOfRange = chain(:,i) &lt; iterRanges.LB(i) | chain(:,i) &gt; iterRanges.UB(i);
0066    chain(outOfRange,:) = []; 
0067 <span class="keyword">end</span>
0068 
0069 <span class="comment">%calculate the reflectivity and SLD for all the in-range fits.</span>
0070 numCalcs = size(chain,1);
0071 allRefs = cell(numCalcs,1);
0072 allSLDs = cell(numCalcs,1);
0073 <span class="keyword">for</span> i = 1:numCalcs
0074     problemDef.fitpars = chain(i,1:end-1);
0075     problemDef = <a href="../../minimisers/generalUtils/unpackparams.html" class="code" title="function problemDef = unpackparams(problemDef,controls)">unpackparams</a>(problemDef,controls);
0076     [problem,result] = reflectivity_calculation(problemDef,problemDef_cells,problemDef_limits,controls);
0077     allRefs{i} = result{1};
0078     allSLDs{i} = result{5};
0079 <span class="keyword">end</span>
0080 
0081 <span class="comment">%Also calculate the best fit</span>
0082 problemDef.fitpars = values(:,1);
0083 problemDef = <a href="../../minimisers/generalUtils/unpackparams.html" class="code" title="function problemDef = unpackparams(problemDef,controls)">unpackparams</a>(problemDef,controls);
0084 [problem,result] = reflectivity_calculation(problemDef,problemDef_cells,problemDef_limits,controls);
0085 bestFit = result{1};
0086 
0087 
0088 <span class="comment">%Put the reflectivities for each contrast together</span>
0089 <span class="keyword">for</span> n = 1:numCalcs
0090     <span class="keyword">for</span> i = 1:problemDef.numberOfContrasts
0091         <span class="comment">%Since array size may vary if qz-shift is fitted</span>
0092         <span class="comment">%interpolate all curves onto the x-range of the first</span>
0093         thisRef = allRefs{n}{i};
0094 <span class="comment">%         if n == 1</span>
0095 <span class="comment">%             referenceRef = thisRef;</span>
0096 <span class="comment">%             groupRefs{i}(:,n) = referenceRef(:,2);</span>
0097 <span class="comment">%         else</span>
0098             newRefy = interp1(thisRef(:,1),thisRef(:,2),bestFit{i}(:,1));
0099             groupRefs{i}(:,n) = newRefy;
0100         <span class="comment">%end</span>
0101     <span class="keyword">end</span>
0102 <span class="keyword">end</span>
0103 
0104 <span class="keyword">for</span> i = 1:problemDef.numberOfContrasts
0105     range.mins{i} = min(groupRefs{i},[],2);
0106     range.maxs{i} = max(groupRefs{i},[],2);
0107 <span class="keyword">end</span>
0108 
0109 disp(<span class="string">'debug'</span>);
0110 debugPlot = 1;
0111 <span class="keyword">switch</span> debugPlot
0112     <span class="keyword">case</span> 1
0113         figure(1); clf; hold on; set(gca,<span class="string">'YScale'</span>,<span class="string">'log'</span>);set(gca,<span class="string">'YScale'</span>,<span class="string">'log'</span>);set(gca,<span class="string">'XScale'</span>,<span class="string">'log'</span>);
0114         <span class="keyword">for</span> i = 1:problemDef.numberOfContrasts
0115             <span class="keyword">if</span> i == 1
0116                 f = 1;
0117             <span class="keyword">else</span>
0118                 f = 1/(10^(2*i));
0119             <span class="keyword">end</span>
0120             errorbar(result{3}{i}(:,1),result{3}{i}(:,2)*f,result{3}{i}(:,3)*f,<span class="string">'b.'</span>);
0121             semilogy(bestFit{i}(:,1),bestFit{i}(:,2)*f,<span class="string">'k-'</span>);
0122             semilogy(bestFit{i}(:,1),range.maxs{i}*f,<span class="string">'r-'</span>);
0123             semilogy(bestFit{i}(:,1),range.mins{i}*f,<span class="string">'r-'</span>);
0124         <span class="keyword">end</span>
0125         <span class="comment">%set(gca,'Xlim',[0.049 0.4])</span>
0126 <span class="keyword">end</span>
0127             
0128 results.bestFits = bestFit;
0129 results.chain = outChain;
0130 results.ranges = <a href="../../minimisers/mcmcstat/range.html" class="code" title="function y=range(x)">range</a>;
0131 results.bestPars = values(:,1);
0132 
0133 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Wed 28-Jul-2021 14:15:23 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>