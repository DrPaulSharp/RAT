<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of refModel</title>
  <meta name="keywords" content="refModel">
  <meta name="description" content="Returns the reflectivity profile. Need to do some extra work because">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../menu.html minimisers --><!-- menu.html mcmcstat_new -->
<h1>refModel
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>Returns the reflectivity profile. Need to do some extra work because</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function ymod = refModel(data,problem,theta,varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Returns the reflectivity profile. Need to do some extra work because
 'reflectivity-calculation' adjusts the data according to scalefactor.
 We need to reverse this correction, and actually return the simulation
 corrected for the scalefactor. We have to do this because the scalefactor 
 is in itself one of our fitting parameters (no need to correct the data -
 problem.shifted_data contains the corrected data, but
 problem.data is a record of the original).</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../minimisers/generalUtils/unpackparams.html" class="code" title="function problemDef = unpackparams(problemDef,controls)">unpackparams</a>	Unpack the params out of the fitparsma and otherparams arrays</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../minimisers/mcmcstat/mcmcpred_compile.html" class="code" title="function out=mcmcpred_compile(results,chain,s2chain,data,problem,nsample,varargin)">mcmcpred_compile</a>	MCMCPRED predictive calculations from the mcmcrun chain</li><li><a href="../../minimisers/runBayesCalc.html" class="code" title="function output = runBayes(loop,nsimu,burnin,params)">runBayesCalc</a>	Clear any values from previous runs if prsent</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function ymod = refModel(data,problem,theta,varargin)</a>
0002 
0003 <span class="comment">% Returns the reflectivity profile. Need to do some extra work because</span>
0004 <span class="comment">% 'reflectivity-calculation' adjusts the data according to scalefactor.</span>
0005 <span class="comment">% We need to reverse this correction, and actually return the simulation</span>
0006 <span class="comment">% corrected for the scalefactor. We have to do this because the scalefactor</span>
0007 <span class="comment">% is in itself one of our fitting parameters (no need to correct the data -</span>
0008 <span class="comment">% problem.shifted_data contains the corrected data, but</span>
0009 <span class="comment">% problem.data is a record of the original).</span>
0010 
0011 <span class="keyword">if</span> isempty(varargin)
0012     contrast = 1;
0013 <span class="keyword">else</span>
0014     contrast = varargin{1};
0015 <span class="keyword">end</span>
0016 
0017 <span class="keyword">if</span> iscell(data)
0018     thisData = data{contrast};<span class="comment">%.ydata;</span>
0019     <span class="comment">%problem = data{contrast}.problem;</span>
0020 <span class="keyword">else</span>
0021     thisData = data;<span class="comment">%.ydata;</span>
0022     <span class="comment">%problem = data.problem;</span>
0023 <span class="keyword">end</span>
0024 
0025 <span class="comment">%if nargin == 4</span>
0026 <span class="comment">%    debugPlot = varargin{2};</span>
0027 <span class="comment">%else</span>
0028     debugPlot = 0;
0029 <span class="comment">%end</span>
0030 
0031 pars = theta;
0032 
0033 problemDef = problem{1};
0034 controls = problem{2};
0035 problemDef_limits = problem{3};
0036 problemDef_cells = problem{4};
0037 
0038 problemDef.fitpars = pars;
0039 problemDef = <a href="../../minimisers/generalUtils/unpackparams.html" class="code" title="function problemDef = unpackparams(problemDef,controls)">unpackparams</a>(problemDef,controls);
0040 [problem,result] = reflectivity_calculation_wrapper(problemDef,problemDef_cells,problemDef_limits,controls);
0041 
0042 ySim = result{1}{contrast};
0043 
0044 <span class="comment">% Need to correct the simulation for the scalefactor (i.e. move the sim to</span>
0045 <span class="comment">% the data, unlike what we normally do)</span>
0046 scale = problem.scalefactors(contrast);        
0047 ymod = ySim(:,2).*scale;        <span class="comment">% Do something more flashy here for multiple contrasts</span>
0048 
0049 <span class="comment">% Debug plot to check that everything works..</span>
0050 <span class="comment">%debugPlot = 0;</span>
0051 <span class="keyword">if</span> debugPlot
0052     plot(thisData(:,1),thisData(:,2),<span class="string">'o'</span>);
0053     hold on
0054     plot(ySim(:,1),ymod,<span class="string">'-'</span>);
0055     hold off
0056 <span class="keyword">end</span>
0057 
0058 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Wed 28-Jul-2021 14:15:23 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>