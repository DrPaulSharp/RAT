<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of runSimplex</title>
  <meta name="keywords" content="runSimplex">
  <meta name="description" content="">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../menu.html minimisers --><!-- menu.html simplex -->
<h1>runSimplex
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong></strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function [problemDef,problem,result] = runSimplex(problemDef,problemDef_cells,problemDef_limits,controls) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../minimisers/generalUtils/fitsetup.html" class="code" title="function [problemDef,out] = fitsetup(problemDef,problemDef_cells,problemDef_limits,controls)">fitsetup</a>	</li><li><a href="../../minimisers/generalUtils/unpackparams.html" class="code" title="function problemDef = unpackparams(problemDef,controls)">unpackparams</a>	Unpack the params out of the fitparsma and otherparams arrays</li><li><a href="simplexIntrafun.html" class="code" title="function fval = simplexIntrafun(x,problemDef,problemDef_cells,problemDef_limits,controls,params,maxEval);">simplexIntrafun</a>	problemDef,problemDef_cells,problemDef_limits,controls,params,300</li><li><a href="simplex_xtransform.html" class="code" title="function xtrans = simplex_xtransform(x,params);">simplex_xtransform</a>	converts unconstrained variables into their original domains</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [problemDef,problem,result] = runSimplex(problemDef,problemDef_cells,problemDef_limits,controls)</a>
0002 
0003 numberOfContrasts = problemDef.numberOfContrasts;
0004 preAlloc = zeros(numberOfContrasts,1);
0005 
0006 result = cell(6,1);
0007 
0008 problem = struct(<span class="string">'ssubs'</span>,preAlloc,<span class="keyword">...</span>
0009                  <span class="string">'backgrounds'</span>,preAlloc,<span class="keyword">...</span>
0010                  <span class="string">'qshifts'</span>,preAlloc,<span class="keyword">...</span>
0011                  <span class="string">'scalefactors'</span>,preAlloc,<span class="keyword">...</span>
0012                  <span class="string">'nbairs'</span>,preAlloc,<span class="keyword">...</span>
0013                  <span class="string">'nbsubs'</span>,preAlloc,<span class="keyword">...</span>
0014                  <span class="string">'resolutions'</span>,preAlloc,<span class="keyword">...</span>
0015                  <span class="string">'calculations'</span>,struct(<span class="string">'all_chis'</span>,preAlloc,<span class="string">'sum_chi'</span>,0),<span class="keyword">...</span>
0016                  <span class="string">'allSubRough'</span>,preAlloc);
0017 
0018 
0019 [problemDef,fitNames] = <a href="../../minimisers/generalUtils/fitsetup.html" class="code" title="function [problemDef,out] = fitsetup(problemDef,problemDef_cells,problemDef_limits,controls)">fitsetup</a>(problemDef,problemDef_cells,problemDef_limits,controls);
0020 
0021 maxIter = controls.maxIter;
0022 tolFun = controls.tolFun;
0023 tolX = controls.tolX;
0024 maxFunEvals = controls.maxFunEvals;
0025 display = controls.display;
0026 
0027 options = optimset(<span class="string">'MaxIter'</span>,maxIter,<span class="string">'TolFun'</span>,tolFun,<span class="string">'TolX'</span>,tolX,<span class="string">'MaxFunEvals'</span>,maxFunEvals,<span class="string">'Display'</span>,display);
0028 
0029 x0 = problemDef.fitpars;
0030 LB = problemDef.fitconstr(:,1);
0031 UB = problemDef.fitconstr(:,2);
0032 
0033 <span class="comment">% size checks</span>
0034 xsize = size(x0);
0035 x0 = x0(:);
0036 n=length(x0);
0037 
0038 <span class="keyword">if</span> isempty(LB)
0039   LB = repmat(-inf,n,1);
0040 <span class="keyword">else</span>
0041   LB = LB(:);
0042 <span class="keyword">end</span>
0043 <span class="keyword">if</span> isempty(UB)
0044   UB = repmat(inf,n,1);
0045 <span class="keyword">else</span>
0046   UB = UB(:);
0047 <span class="keyword">end</span>
0048 
0049 <span class="comment">% stuff into a struct to pass around</span>
0050 params.args = [];<span class="comment">%varargin;</span>
0051 params.LB = LB;
0052 params.UB = UB;
0053 params.fun = <span class="string">''</span>;<span class="comment">%problemDef.modelFilename;%fun;</span>
0054 
0055 <span class="comment">% 0 --&gt; unconstrained variable</span>
0056 <span class="comment">% 1 --&gt; lower bound only</span>
0057 <span class="comment">% 2 --&gt; upper bound only</span>
0058 <span class="comment">% 3 --&gt; dual finite bounds</span>
0059 params.BoundClass = zeros(n,1);
0060 <span class="keyword">for</span> i=1:n
0061   k = isfinite(LB(i)) + 2*isfinite(UB(i));
0062   params.BoundClass(i) = k;
0063   <span class="keyword">if</span> (k==3) &amp;&amp; (LB(i)==UB(i))
0064     error <span class="string">'Bounds must be distinct if both are supplied.'</span>
0065   <span class="keyword">end</span>
0066 <span class="keyword">end</span>
0067 
0068 <span class="comment">% transform starting values into their unconstrained</span>
0069 <span class="comment">% surrogates. Check for infeasible starting guesses.</span>
0070 x0u = x0;
0071 <span class="keyword">for</span> i = 1:n
0072   <span class="keyword">switch</span> params.BoundClass(i)
0073     <span class="keyword">case</span> 1
0074       <span class="comment">% lower bound only</span>
0075       <span class="keyword">if</span> x0(i)&lt;=LB(i)
0076         <span class="comment">% infeasible starting value. Use bound.</span>
0077         x0u(i) = 0;
0078       <span class="keyword">else</span>
0079         x0u(i) = sqrt(x0(i) - LB(i));
0080       <span class="keyword">end</span>
0081     <span class="keyword">case</span> 2
0082       <span class="comment">% upper bound only</span>
0083       <span class="keyword">if</span> x0(i)&gt;=UB(i)
0084         <span class="comment">% infeasible starting value. use bound.</span>
0085         x0u(i) = 0;
0086       <span class="keyword">else</span>
0087         x0u(i) = sqrt(UB(i) - x0(i));
0088       <span class="keyword">end</span>
0089     <span class="keyword">case</span> 3
0090       <span class="comment">% lower and upper bounds</span>
0091       <span class="keyword">if</span> x0(i)&lt;=LB(i)
0092         <span class="comment">% infeasible starting value</span>
0093         x0u(i) = -pi/2;
0094       <span class="keyword">elseif</span> x0(i)&gt;=UB(i)
0095         <span class="comment">% infeasible starting value</span>
0096         x0u(i) = pi/2;
0097       <span class="keyword">else</span>
0098         x0u(i) = 2*(x0(i) - LB(i))/(UB(i)-LB(i)) - 1;
0099         x0u(i) = asin(max(-1,min(1,x0u(i))));
0100       <span class="keyword">end</span>
0101     <span class="keyword">case</span> 0
0102       <span class="comment">% unconstrained variable. x0u(i) is set.</span>
0103   <span class="keyword">end</span>
0104 <span class="keyword">end</span>
0105 
0106 <span class="comment">% now we can call fminsearch, but with our own</span>
0107 <span class="comment">% intra-objective function.</span>
0108 
0109 [xu,fval,exitflag,output] = fminsearch(@<a href="simplexIntrafun.html" class="code" title="function fval = simplexIntrafun(x,problemDef,problemDef_cells,problemDef_limits,controls,params,maxEval);">simplexIntrafun</a>,x0u,options,problemDef,problemDef_cells,problemDef_limits,controls,params,300);
0110 
0111 <span class="comment">%[xu,fval,exitflag,output] = simplex(@simplexIntrafun,x0u,problemDef,problemDef_cells,problemDef_limits,controls,options,params,300);</span>
0112 
0113 <span class="comment">% undo the variable transformations into the original space</span>
0114 x = <a href="simplex_xtransform.html" class="code" title="function xtrans = simplex_xtransform(x,params);">simplex_xtransform</a>(xu,params);
0115 
0116 <span class="comment">% final reshape</span>
0117 <span class="comment">%x = reshape(x,xsize);</span>
0118 
0119 problemDef.fitpars = x;
0120 problemDef = <a href="../../minimisers/generalUtils/unpackparams.html" class="code" title="function problemDef = unpackparams(problemDef,controls)">unpackparams</a>(problemDef,controls);
0121 [problem,result] = reflectivity_calculation_wrapper(problemDef,problemDef_cells,problemDef_limits,controls);
0122 
0123 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Wed 28-Jul-2021 14:15:23 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>