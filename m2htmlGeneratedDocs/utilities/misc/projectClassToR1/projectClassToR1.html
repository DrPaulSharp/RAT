<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of projectClassToR1</title>
  <meta name="keywords" content="projectClassToR1">
  <meta name="description" content="Takes an instance of project class and makes this into an r1 type struct.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- # utilities --><!-- # misc --><!-- # projectClassToR1 -->
<h1>projectClassToR1
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>Takes an instance of project class and makes this into an r1 type struct.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function newR1Problem = projectClassToR1(r2Problem,varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Takes an instance of project class and makes this into an r1 type struct.
 Also creates the datafiles directory and saves the data if asked...</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../API/RAT.html" class="code" title="function [outProblemDef,result] = RAT(problemDefInput,controls)">RAT</a>	</li><li><a href="../../../API/controlsDef/controlsDef.html" class="code" title="">controlsDef</a>	</li><li><a href="../../../API/projectClass/dataClass.html" class="code" title="">dataClass</a>	</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function inputBlock = parseParameterInput(varargin)</a></li><li><a href="#_sub2" class="code">function names = getR1FieldNames()</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function newR1Problem = projectClassToR1(r2Problem,varargin)</a>
0002 
0003 <span class="comment">% Takes an instance of project class and makes this into an r1 type struct.</span>
0004 <span class="comment">% Also creates the datafiles directory and saves the data if asked...</span>
0005 
0006 <span class="comment">% Now work through updating the values in the r1 struct with equivalent</span>
0007 <span class="comment">% values in the r2 projectClass</span>
0008 
0009 
0010 <span class="comment">%% Work out inputs and create directories if necessary</span>
0011 <span class="keyword">if</span> ~isempty(varargin)
0012     pars = <a href="#_sub1" class="code" title="subfunction inputBlock = parseParameterInput(varargin)">parseParameterInput</a>(varargin);
0013     
0014     <span class="comment">% Use the named r1Problem</span>
0015     r1Problem = pars.r1Problem;
0016     <span class="keyword">if</span> isfield(r1Problem,<span class="string">'empty'</span>)                <span class="comment">% No r1Problem supplied</span>
0017         r1Problem = load(<span class="string">'defaultProject.mat'</span>);
0018         r1Problem = r1Problem.problem;
0019     <span class="keyword">end</span>
0020     
0021     saveTheProject = pars.saveProject;
0022     fileName = pars.fileName;
0023     
0024     <span class="comment">% (1) Check the directory exists</span>
0025     <span class="comment">% Check if the required directory exists....</span>
0026     dirName = pars.dirName;
0027     dirPath = pars.dirPath;
0028     fullName = fullfile(dirPath,dirName);
0029     <span class="keyword">if</span> ~exist(fullName,<span class="string">'dir'</span>) &amp;&amp; saveTheProject
0030         warning(<span class="string">'Required directory %s does not exist. Creating it'</span>,fullName);
0031         <span class="comment">% Directory does not exist</span>
0032         <span class="comment">% Go to the specified path</span>
0033         <span class="comment">% and make the project directories.</span>
0034         cd(dirPath);
0035         mkdir(dirName);
0036         originalDir = pwd;
0037         cd(dirName);
0038         <span class="keyword">if</span> ~exist(<span class="string">'datafiles'</span>,<span class="string">'dir'</span>)
0039             mkdir(<span class="string">'datafiles'</span>);
0040         <span class="keyword">end</span>
0041     <span class="keyword">end</span>
0042 <span class="keyword">end</span>
0043 
0044 
0045 
0046 
0047 <span class="comment">%% Geometry and exp type block</span>
0048 <span class="comment">% Get parameters from R2</span>
0049 geometry = r2Problem.Geometry;
0050 type = r2Problem.ModelType;
0051 name = r2Problem.experimentName;
0052 
0053 <span class="comment">% Put these into the R1 struct..</span>
0054 r1Problem.name = name;
0055 r1Problem.module.type = type;
0056 r1Problem.module.experiment_type = geometry;
0057 
0058 <span class="comment">%% Parameter Names, values, limits and check boxes</span>
0059 r2ParamStruct = r2Problem.parameters.toStruct;
0060 
0061 paramNames = r2ParamStruct.paramNames;
0062 nParams = r2ParamStruct.nParams;
0063 paramConstr = r2ParamStruct.paramConstr;
0064 fitYesNo = r2ParamStruct.fitYesNo;
0065 paramValues = r2ParamStruct.params;
0066 
0067 r1Problem.params = paramValues;
0068 r1Problem.paramnames = paramNames;
0069 
0070 theseConstr = [];
0071 <span class="keyword">for</span> i = 1:nParams
0072     theseConstr(i,:) = paramConstr{i};
0073 <span class="keyword">end</span>
0074 
0075 r1Problem.constr = theseConstr;
0076 r1Problem.fityesno = fitYesNo;
0077 
0078 <span class="comment">%% Qz shifts</span>
0079 
0080 
0081 
0082 r1Problem.numberOfShifts = 1;
0083 r1Problem.shiftsNames = {<span class="string">'Shift 1'</span>};
0084 r1Problem.shifts_horisontal = 0;
0085 r1Problem.numberOfShifts = 1;
0086 r1Problem.shifts_constr = [-1e-4 1e-4];
0087 r1Problem.shifts_fityesno = 0;
0088 
0089 <span class="comment">%% Scalefactors....</span>
0090 r2ScalesStruct = r2Problem.scalefactors.toStruct();
0091 
0092 scalesNames = r2ScalesStruct.paramNames;
0093 nScales = r2ScalesStruct.nParams;
0094 scalesConstr = r2ScalesStruct.paramConstr;
0095 fitYesNo = r2ScalesStruct.fitYesNo;
0096 scalesValues = r2ScalesStruct.params;
0097 
0098 r1Problem.scalesNames = scalesNames;
0099 r1Problem.scalefac = scalesValues;
0100 r1Problem.numberOfScales = nScales;
0101 
0102 theseConstr = [];
0103 <span class="keyword">for</span> i = 1:nScales
0104     theseConstr(i,:) = scalesConstr{i};
0105 <span class="keyword">end</span>
0106 
0107 r1Problem.scale_constr = theseConstr;
0108 r1Problem.scalefac_fityesno = fitYesNo;
0109 
0110 <span class="comment">%% Bulk in</span>
0111 r2BulkInStruct = r2Problem.bulkIn.toStruct();
0112 
0113 bulkInNames = r2BulkInStruct.paramNames;
0114 nbulkIn = r2BulkInStruct.nParams;
0115 bulkInConstr = r2BulkInStruct.paramConstr;
0116 bulkInFitYesNo = r2BulkInStruct.fitYesNo;
0117 bulkInValues = r2BulkInStruct.params;
0118 
0119 r1Problem.nbaNames = bulkInNames;
0120 r1Problem.nba = bulkInValues;
0121 r1Problem.numberOfNbas = nbulkIn;
0122 
0123 theseConstr = [];
0124 <span class="keyword">for</span> i = 1:nbulkIn
0125     theseConstr(i,:) = bulkInConstr{i};
0126 <span class="keyword">end</span>
0127 
0128 r1Problem.nbairs_constr = theseConstr;
0129 r1Problem.nbairs_fityesno = bulkInFitYesNo;
0130 
0131 
0132 <span class="comment">%% Bulk out</span>
0133 r2BulkOutStruct = r2Problem.bulkOut.toStruct();
0134 
0135 bulkOutNames = r2BulkOutStruct.paramNames;
0136 nbulkOut = r2BulkOutStruct.nParams;
0137 bulkOutConstr = r2BulkOutStruct.paramConstr;
0138 bulkOutFitYesNo = r2BulkOutStruct.fitYesNo;
0139 bulkOutValues = r2BulkOutStruct.params;
0140 
0141 r1Problem.nbsNames = bulkOutNames;
0142 r1Problem.nbs = bulkOutValues;
0143 r1Problem.numberOfNbss = nbulkOut;
0144 
0145 theseConstr = [];
0146 <span class="keyword">for</span> i = 1:nScales
0147     theseConstr(i,:) = bulkOutConstr{i};
0148 <span class="keyword">end</span>
0149 
0150 r1Problem.nbsubs_constr = theseConstr;
0151 r1Problem.nbsubs_fityesno = bulkOutFitYesNo;
0152 
0153 <span class="comment">%% Resolutions</span>
0154 r2ResolStruct = r2Problem.resolution.toStruct();
0155 
0156 <span class="comment">% Only use resolpars - don't have more advanced resolutions in R1...</span>
0157 resolNames = r2ResolStruct.resolParNames;
0158 nResols = r2ResolStruct.nResolPars;
0159 resolConstr = r2ResolStruct.resolParConstr;
0160 resolFitYesNo = r2ResolStruct.resolFitYesNo;
0161 resolValues = r2ResolStruct.resolPars;
0162 
0163 r1Problem.resolNames = resolNames;
0164 r1Problem.resolution = resolValues;
0165 r1Problem.numberOfResolutions = nResols;
0166 
0167 theseConstr = [];
0168 <span class="keyword">for</span> i = 1:nResols
0169     theseConstr(i,:) = resolConstr{i};
0170 <span class="keyword">end</span>
0171 
0172 r1Problem.reslution_constr = theseConstr;
0173 r1Problem.resolution_fityesno = resolFitYesNo;
0174 
0175 
0176 <span class="comment">%% Backgrounds...</span>
0177 r2BackStruct = r2Problem.background.toStruct();
0178 
0179 <span class="comment">% Only use resolpars - don't have more advanced resolutions in R1...</span>
0180 backsNames = r2BackStruct.backParNames;
0181 nBacks = r2BackStruct.nBackPars;
0182 backsConstr = r2BackStruct.backParconstr;
0183 backsFitYesNo = r2BackStruct.backParFitYesNo;
0184 backsValues = r2BackStruct.backParVals;
0185 
0186 r1Problem.backsNames = backsNames;
0187 r1Problem.backs = backsValues;
0188 r1Problem.numberOfBacks = nBacks;
0189 
0190 theseConstr = [];
0191 <span class="keyword">for</span> i = 1:nBacks
0192     theseConstr(i,:) = backsConstr{i};
0193 <span class="keyword">end</span>
0194 
0195 r1Problem.backs_constr = theseConstr;
0196 r1Problem.backgrounds_fityesno = backsFitYesNo;
0197 
0198 
0199 <span class="comment">%% Now, if it is Standard Layers, deal with the layers....</span>
0200 <span class="keyword">if</span> strcmpi(type,<span class="string">'standard layers'</span>)
0201     
0202     allLayers = r2Problem.layers;
0203     layersTable = table2cell(allLayers.layersTable);
0204     numberOfLayers = size(layersTable,1);
0205     
0206     <span class="keyword">for</span> i = 1:numberOfLayers
0207         thisLayer = layersTable(i,:);
0208         
0209         thisLayerName = char(thisLayer{1});
0210         thisLayerThick = char(thisLayer{2});
0211         thisLayerSLD = char(thisLayer{3});
0212         thisLayerRough = char(thisLayer{4});
0213         thisLayerHydr = char(thisLayer{5});
0214         thisLayerHydrWhat = char(thisLayer{6});
0215         
0216         thisThickInd = find(strcmpi(thisLayerThick,r1Problem.paramnames));
0217         thisSLDInd = find(strcmpi(thisLayerSLD,r1Problem.paramnames));
0218         thisRoughInd = find(strcmpi(thisLayerRough,r1Problem.paramnames));
0219         thisHydrInd = find(strcmpi(thisLayerHydr,r1Problem.paramnames));
0220         
0221         <span class="keyword">if</span> strcmpi(thisLayerHydrWhat,<span class="string">'bulk out'</span>)
0222             hydrWhat = <span class="string">'bulk out'</span>;
0223         <span class="keyword">else</span>
0224             hydrWhat = <span class="string">'bulk in'</span>;
0225         <span class="keyword">end</span>
0226         
0227         newLayerCell = {thisThickInd,thisSLDInd,thisRoughInd,thisHydrInd,thisLayerName,hydrWhat};
0228         newLayersDetails{i} = newLayerCell;
0229         layersNames{i} = thisLayerName;
0230     <span class="keyword">end</span>
0231 
0232 <span class="keyword">else</span>
0233     <span class="comment">% If it's not layers, then set up the relevant custom model..</span>
0234     newLayersDetails = {};
0235     numberOfLayers = 0;
0236     
0237     <span class="comment">% Get the custom file name..</span>
0238     customFiles = r2Problem.customFile.toStruct().files{:};
0239     customFiles = customFiles(1,:); <span class="comment">% Only ever 1 custom file in R1</span>
0240     customFileName = customFiles{1};
0241     
0242     cd(originalDir);
0243     copyfile(customFileName,dirName);
0244     cd(dirName);
0245     
0246     
0247 <span class="keyword">end</span>
0248 
0249 <span class="comment">%% Deal with the data and contrasts</span>
0250 <a href="../../../API/projectClass/dataClass.html" class="code" title="">dataClass</a> = r2Problem.data;         <span class="comment">% Data class object</span>
0251 contrasts = r2Problem.contrasts;    <span class="comment">% Contrasts class object</span>
0252 
0253 <span class="comment">% Ensure contrasts table has been built (normally only happens when</span>
0254 <span class="comment">% contrast class is displayed</span>
0255 r2Problem.contrasts.makeContrastsTable();
0256 
0257 numberOfContrasts = contrasts.numberOfContrasts;
0258 r1Problem.numberOfContrasts = numberOfContrasts;
0259 
0260 contrastBacks = zeros(numberOfContrasts,1);
0261 contrastScales = zeros(numberOfContrasts,1);
0262 contrastShifts = ones(numberOfContrasts,1);
0263 contrastResolutions = zeros(numberOfContrasts,1);
0264 contrastNbas = zeros(numberOfContrasts,1);
0265 contrastNbss = zeros(numberOfContrasts,1);
0266 contrastLayers = cell(numberOfContrasts,1);
0267 contrastsNumberOfLayers = zeros(numberOfContrasts,1);
0268 forceReload = zeros(numberOfContrasts,1);
0269 
0270 simLimits = cell(numberOfContrasts,1);
0271 dataLimits = cell(numberOfContrasts,1);
0272 fitlowrange = zeros(numberOfContrasts,1);
0273 fithirange = zeros(numberOfContrasts,1);
0274 
0275 data = cell(numberOfContrasts,1);
0276 contrastNames = cell(numberOfContrasts,1);
0277 contrastFiles = cell(numberOfContrasts,1);
0278 dataPath = {};
0279 contrastTable = table2cell(contrasts.contrastsTable);
0280 
0281 <span class="keyword">for</span> i = 1:numberOfContrasts
0282     thisContrast = contrasts.contrasts{i};
0283     
0284     <span class="comment">% The the relative components</span>
0285     thisName = thisContrast.name;
0286     thisNba = thisContrast.nba;
0287     thisNbs = thisContrast.nbs;
0288     thisResol = thisContrast.resolution;
0289     thisScale = thisContrast.scalefactor;
0290     thisBack = thisContrast.background;
0291     
0292     <span class="comment">% Get the relevant data from the r2 project</span>
0293     contrastNames{i} = thisName;
0294     
0295     <span class="comment">% Nba..</span>
0296     bulkInLoc = strfind(bulkInNames,thisNba);
0297     bulkInIndex = find(not(cellfun(<span class="string">'isempty'</span>,bulkInLoc)));
0298     contrastNbas(i) = bulkInIndex;
0299     
0300     <span class="comment">% Nbs</span>
0301     bulkOutLoc = strfind(bulkOutNames,thisNbs);
0302     bulkOutIndex = find(not(cellfun(<span class="string">'isempty'</span>,bulkOutLoc)));
0303     contrastNbss(i) = bulkOutIndex;
0304     
0305     <span class="comment">% Scalefactors</span>
0306     scaleLoc = strfind(scalesNames,thisScale);
0307     scaleIndex = find(not(cellfun(<span class="string">'isempty'</span>,scaleLoc)));
0308     contrastScales(i) = scaleIndex;
0309    
0310     <span class="comment">% Resol</span>
0311     <span class="comment">% Find the resol name in the resolutions struct</span>
0312     resolutionNames = r2ResolStruct.resolutionNames;
0313     thisResolInd = find(strcmp(resolutionNames,thisResol));
0314     
0315     <span class="comment">% Find which resolution par this is..</span>
0316     thisResolParName = r2ResolStruct.resolutionValues{thisResolInd,1};
0317     resolParNames = r2ResolStruct.resolParNames;    
0318     thisResolParInd = find(strcmp(resolParNames,thisResolParName));
0319     contrastResolutions(i) = thisResolParInd;
0320     
0321     <span class="comment">% Backgrounds</span>
0322     <span class="comment">% Find the Background name in the backgrounds struct</span>
0323     backgroundNames = r2BackStruct.backgroundNames;
0324     thisBacksInd = find(strcmp(backgroundNames,thisBack));
0325     
0326     <span class="comment">% Find which resolution par this is..</span>
0327     thisBacksParName = r2BackStruct.backgroundValues{thisBacksInd,1};
0328     backParNames = r2BackStruct.backParNames;    
0329     thisBackParInd = find(strcmp(backParNames,thisBacksParName));
0330     contrastBacks(i) = thisBackParInd;
0331 
0332     <span class="comment">% Data</span>
0333     dataTable = table2cell(dataClass.dataTable);
0334     r2DataNames = dataTable(:,1);
0335     r2DataNames = cellfun(@(x)char(x), r2DataNames, <span class="string">'UniformOutput'</span>, false);
0336     thisContrastData = thisContrast.data;
0337     thisContrastLocation = find(strcmp(r2DataNames,thisContrastData));
0338     thisData = dataTable{thisContrastLocation,2};
0339     thisSimLimits = dataTable{thisContrastLocation,4};
0340     thisDataLimits = dataTable{thisContrastLocation,3};
0341     data{i} = thisData;
0342     simLimits{i} = thisSimLimits;
0343     dataLimits{i} = thisDataLimits;
0344     
0345     fitlowrange(i) = thisDataLimits(1);
0346     fithirange(i) = thisDataLimits(2);
0347     
0348     <span class="keyword">if</span> ~strcmpi(thisContrastData,<span class="string">'simulation'</span>)
0349         dataPresent(i) = 1;
0350         include_data(i) = 1;
0351         dataTypes{i} = <span class="string">'Ascii File'</span>;
0352     <span class="keyword">else</span>
0353         dataPresent(i) = 0;
0354         include_data(i) = 0;
0355         dataTypes{i} = <span class="string">'Simulation'</span>;
0356     <span class="keyword">end</span>
0357     
0358     <span class="comment">% Now deal with the model. Depends on whether it is standard layers or</span>
0359     <span class="comment">% a custom model.</span>
0360     <span class="keyword">if</span> strcmpi(type,<span class="string">'standard layers'</span>)
0361         <span class="comment">% Set up the contrastLayers strings</span>
0362         <span class="comment">% Get the model for this contrast</span>
0363         model = thisContrast.model;
0364         thisLayerString = <span class="string">''</span>;
0365         <span class="keyword">for</span> n = 1:length(model)
0366             thisLay = model{n};
0367             thisLayNum = find(strcmpi(layersNames,thisLay));
0368             thisLayChar = sprintf(<span class="string">'%s,'</span>,num2str(thisLayNum));
0369             thisLayerString = [thisLayerString thisLayChar];
0370         <span class="keyword">end</span>
0371         contrastLayers{i} = thisLayerString;
0372         contrastsNumberOfLayers = length(model);
0373         customFileName = <span class="string">''</span>;
0374     <span class="keyword">else</span>
0375         <span class="comment">% We are using a custom model</span>
0376         whichCustom = thisContrast.model{:};
0377         fileTable = table2cell(r2Problem.customFile.fileTable);
0378         customNames = fileTable(:,1);
0379         customNames = cellfun(@(x)char(x), customNames, <span class="string">'UniformOutput'</span>, false);
0380         thisCustomLocation = find(strcmp(customNames,whichCustom));
0381         customFileName = char(fileTable{thisCustomLocation,2});
0382         contrastLayers{i} = <span class="string">''</span>;
0383         contrastsNumberOfLayers(i) = 0;
0384     <span class="keyword">end</span>
0385     contrastRepeatSLDs{i} = [0 1];
0386 <span class="keyword">end</span>
0387 
0388 r1Problem.contrastTypes = dataTypes;
0389 
0390 <span class="comment">%%</span>
0391 <span class="comment">%r1Problem.module.name = customFileName;</span>
0392 r1Problem.contrastNames = contrastNames;
0393 r1Problem.contrastNbas = contrastNbas;
0394 r1Problem.contrastNbss = contrastNbss;
0395 r1Problem.contrastScales = contrastScales;
0396 r1Problem.contrastShifts = contrastShifts;
0397 r1Problem.contrastResolutions = contrastResolutions;
0398 r1Problem.contrastBacks = contrastBacks;
0399 r1Problem.data = data;
0400 r1Problem.include_data = include_data;
0401 r1Problem.dataPresent = dataPresent;
0402 r1Problem.contrastLayers = contrastLayers;
0403 r1Problem.contrastsNumberOfLayers = contrastsNumberOfLayers;
0404 <span class="comment">% Put everything into the R1 problem</span>
0405 r1Problem.layersDetails = newLayersDetails;
0406 r1Problem.numberOfLayers = numberOfLayers;    
0407 r1Problem.module.name = customFileName;
0408 r1Problem.forceReload = forceReload;
0409 r1Problem.dataLimits = dataLimits;
0410 r1Problem.simLimits = simLimits;
0411 r1Problem.fitlowrange = fitlowrange;
0412 r1Problem.fithirange = fithirange;
0413 r1Problem.repeatLayers = contrastRepeatSLDs;
0414 
0415 <span class="comment">% Finally need to actually fill in some calculation results in the r1</span>
0416 <span class="comment">% model. We can do this using RAT...</span>
0417 
0418 controls = <a href="../../../API/controlsDef/controlsDef.html" class="code" title="">controlsDef</a>;
0419 controls.display = <span class="string">'off'</span>;
0420 [~,results] = <a href="../../../API/RAT.html" class="code" title="function [outProblemDef,result] = RAT(problemDefInput,controls)">RAT</a>(r2Problem,controls);
0421 
0422 r1Problem.shifted_data = results.shifted_data;
0423 r1Problem.calculations.Simulation = results.Simulation;
0424 r1Problem.calculations.reflectivity = results.reflectivity;
0425 r1Problem.calculations.slds = results.sldProfiles;
0426 r1Problem.calculations.all_chis = results.calculationResults.all_chis;
0427 r1Problem.calculations.sum_chi = results.calculationResults.sum_chi;
0428 
0429 newR1Problem = r1Problem;
0430 
0431 <span class="comment">% If the save project flag is set, then save the new peoject</span>
0432 <span class="keyword">if</span> saveTheProject
0433     
0434     <span class="comment">% Save and name the datafiles, and set the paths, data filenames in the</span>
0435     <span class="comment">% r1problem</span>
0436     
0437     data = r1Problem.data;
0438     <span class="keyword">for</span> i = 1:length(data)
0439         thisData = data{i};
0440         thisFileName = sprintf([fileName,<span class="string">'_dataFile_%s'</span>],num2str(i));
0441         contrastFiles{i} = thisFileName;
0442         fullDataFileName = fullfile(fullName,<span class="string">'datafiles'</span>,thisFileName);
0443         dlmwrite(fullDataFileName,thisData);
0444     <span class="keyword">end</span>
0445     problem = r1Problem;
0446     problem.contrastFiles = contrastFiles;
0447     
0448     [p,n,e] = fileparts(fileName);
0449     <span class="keyword">if</span> isempty(e)
0450         e = <span class="string">'.mat'</span>;
0451     <span class="keyword">end</span>
0452     filename = [n,e];
0453     fullFileName = fullfile(fullName,filename);
0454     save(fullFileName,<span class="string">'problem'</span>);
0455 <span class="keyword">end</span>
0456 
0457 <span class="keyword">end</span>
0458 
0459 <a name="_sub1" href="#_subfunctions" class="code">function inputBlock = parseParameterInput(varargin)</a>
0460 
0461     default_r1Problem = struct(<span class="string">'empty'</span>,0);
0462     default_dirName = <span class="string">'newDirectory'</span>;   
0463     default_saveProject = true;
0464     default_dirPath = pwd;
0465     default_fileName = sprintf(<span class="string">'newFile_%s'</span>,datestr(now));
0466 
0467     p = inputParser;
0468     addParameter(p,<span class="string">'r1Problem'</span>,     default_r1Problem,      @isstruct);
0469     addParameter(p,<span class="string">'dirName'</span>,       default_dirName,        @ischar);
0470     addParameter(p,<span class="string">'dirPath'</span>,       default_dirPath,        @ischar);
0471     addParameter(p,<span class="string">'saveProject'</span>,   default_saveProject,    @islogical);
0472     addParameter(p,<span class="string">'fileName'</span>,      default_fileName,       @ischar);
0473     
0474     inputVals = varargin{:};
0475     
0476     parse(p,inputVals{:});
0477     inputBlock = p.Results;
0478     
0479     <span class="comment">% Check the r1Problem really is one by making sure it has the bare</span>
0480     <span class="comment">% minimum of field names</span>
0481     <span class="keyword">if</span> ~isequal(inputBlock.r1Problem,(struct(<span class="string">'empty'</span>,0)))
0482         r1FieldNames = <a href="#_sub2" class="code" title="subfunction names = getR1FieldNames()">getR1FieldNames</a>();
0483         newNames = fieldnames(inputBlock.r1Problem);
0484         diffs = setdiff(newNames,r1FieldNames);
0485         
0486         allowedDiffs = {<span class="string">'priors'</span> ; <span class="string">'resampleAngle'</span>; <span class="string">'resampleNLayers'</span>;<span class="keyword">...</span>
0487             <span class="string">'fitpars'</span> ; <span class="string">'otherpars'</span>; <span class="string">'fitnames'</span>};
0488         
0489         actualDiffs = intersect(diffs,allowedDiffs);
0490         
0491         <span class="keyword">if</span> ~isequal(actualDiffs,diffs)
0492             error(<span class="string">'Can''t recognise inputted r1Problem'</span>);
0493         <span class="keyword">end</span>
0494     <span class="keyword">end</span>
0495     
0496 <span class="keyword">end</span>
0497 
0498 
0499 <a name="_sub2" href="#_subfunctions" class="code">function names = getR1FieldNames()</a>
0500 
0501 names =     {<span class="string">'path'</span>          ;        
0502     <span class="string">'name'</span>                   ;
0503     <span class="string">'numberOfContrasts'</span>      ;
0504     <span class="string">'module'</span>                 ;
0505     <span class="string">'paramnames'</span>             ;
0506     <span class="string">'constr'</span>                 ;
0507     <span class="string">'params'</span>                 ;
0508     <span class="string">'fityesno'</span>               ;
0509     <span class="string">'fiterrs'</span>                ;
0510     <span class="string">'numberOfLayers'</span>         ;
0511     <span class="string">'layersDetails'</span>          ;
0512     <span class="string">'numberOfBacks'</span>          ;
0513     <span class="string">'backgrounds_fityesno'</span>   ;
0514     <span class="string">'backsNames'</span>             ;
0515     <span class="string">'backs_constr'</span>           ;
0516     <span class="string">'backs'</span>                  ;
0517     <span class="string">'numberOfShifts'</span>         ;
0518     <span class="string">'shifts_fityesno'</span>        ;
0519     <span class="string">'shiftsNames'</span>            ;
0520     <span class="string">'shifts_constr'</span>          ;
0521     <span class="string">'shifts_horisontal'</span>      ;
0522     <span class="string">'numberOfScales'</span>         ;
0523     <span class="string">'scalefac_fityesno'</span>      ;
0524     <span class="string">'scalesNames'</span>            ;
0525     <span class="string">'scale_constr'</span>           ;
0526     <span class="string">'scalefac'</span>               ;
0527     <span class="string">'numberOfNbas'</span>           ;
0528     <span class="string">'nbairs_fityesno'</span>        ;
0529     <span class="string">'nbaNames'</span>               ;
0530     <span class="string">'nbairs_constr'</span>          ;
0531     <span class="string">'nba'</span>                    ;
0532     <span class="string">'numberOfNbss'</span>           ;
0533     <span class="string">'nbsubs_fityesno'</span>        ;
0534     <span class="string">'nbsNames'</span>               ;
0535     <span class="string">'nbsubs_constr'</span>          ;
0536     <span class="string">'nbs'</span>                    ;
0537     <span class="string">'numberOfResolutions'</span>    ;
0538     <span class="string">'resolution_fityesno'</span>    ;
0539     <span class="string">'resolNames'</span>             ;
0540     <span class="string">'resolution_constr'</span>      ;
0541     <span class="string">'resolution'</span>             ;
0542     <span class="string">'contrastTypes'</span>          ;
0543     <span class="string">'contrastFileTypes'</span>      ;
0544     <span class="string">'forceReload'</span>            ;
0545     <span class="string">'simLimits'</span>              ;
0546     <span class="string">'dataLimits'</span>             ;
0547     <span class="string">'fitlowrange'</span>            ;
0548     <span class="string">'fithirange'</span>             ;
0549     <span class="string">'repeatLayers'</span>           ;
0550     <span class="string">'datapath'</span>               ;
0551     <span class="string">'contrastFiles'</span>          ;
0552     <span class="string">'contrastNames'</span>          ;
0553     <span class="string">'contrastBacks'</span>          ;
0554     <span class="string">'contrastScales'</span>         ;
0555     <span class="string">'contrastShifts'</span>         ;
0556     <span class="string">'contrastResolutions'</span>    ;
0557     <span class="string">'contrastNbas'</span>           ;
0558     <span class="string">'contrastNbss'</span>           ;
0559     <span class="string">'contrastLayers'</span>         ;
0560     <span class="string">'contrastsNumberOfLayers'</span>;
0561     <span class="string">'ogDetails'</span>              ;
0562     <span class="string">'data'</span>                   ;
0563     <span class="string">'include_data'</span>           ;
0564     <span class="string">'dataPresent'</span>            ;
0565     <span class="string">'calculations'</span>           ;
0566     <span class="string">'algorithm'</span>              ;
0567     <span class="string">'eb'</span>                     ;
0568     <span class="string">'plotType'</span>               ;
0569     <span class="string">'dataShiftValue'</span>         ;
0570     <span class="string">'q4'</span>                     ;
0571     <span class="string">'useReducedChiSquared'</span>   ;
0572     <span class="string">'simNPoints'</span>             ;
0573     <span class="string">'backgrounds'</span>            ;
0574     <span class="string">'qshifts'</span>                ;
0575     <span class="string">'scalefactors'</span>           ;
0576     <span class="string">'nbairs'</span>                 ;
0577     <span class="string">'nbsubs'</span>                 ;
0578     <span class="string">'resolutions'</span>            ;
0579     <span class="string">'fitpars'</span>                ;
0580     <span class="string">'otherpars'</span>              ;
0581     <span class="string">'fitconstr'</span>              ;
0582     <span class="string">'otherconstr'</span>            ;
0583     <span class="string">'fitNames'</span>               ;
0584     <span class="string">'shifted_data'</span>           ;
0585     <span class="string">'update'</span>                 ;
0586     <span class="string">'update_params'</span>          ;
0587     <span class="string">'maxiter'</span>                ;
0588     <span class="string">'Update'</span>                 ;
0589     <span class="string">'calcSLD'</span>                ;
0590     <span class="string">'resolType'</span>              ;
0591     <span class="string">'resample'</span>};
0592 
0593 <span class="keyword">end</span>
0594 
0595 
0596 
0597</pre></div>
<hr><address>Generated on Tue 14-Jun-2022 14:25:37 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>